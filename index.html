<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/acorn_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/acorn_16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="mij0lb&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="mij0lb&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="mij0lb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>mij0lb's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">mij0lb's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">宁静致远</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-7-shell%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-7-shell%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">linux基础_7.shell编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:23:01" itemprop="dateCreated datePublished" datetime="2020-10-11T09:23:01+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:25" itemprop="dateModified" datetime="2020-10-13T12:58:25+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="基础正则表达式"><a href="#基础正则表达式" class="headerlink" title="基础正则表达式"></a>基础正则表达式</h2><h3 id="正则表达式与通配符区别"><a href="#正则表达式与通配符区别" class="headerlink" title="正则表达式与通配符区别"></a>正则表达式与通配符区别</h3><table>
<thead>
<tr>
<th>正则</th>
<th>通配符{*？-[]}</th>
</tr>
</thead>
<tbody><tr>
<td>在文件中匹配符合条件的字符串</td>
<td>匹配符合条件的文件名</td>
</tr>
<tr>
<td>包含匹配</td>
<td>完全匹配</td>
</tr>
<tr>
<td>grep,awk,sed等命令支持正则</td>
<td>ls，find,cp不支持正则，只能用shell的通配符匹配</td>
</tr>
</tbody></table>
<h5 id="完全匹配"><a href="#完全匹配" class="headerlink" title="完全匹配"></a>完全匹配</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013093007.png" alt="image-20201013093007746" style="zoom:67%;" />

<h5 id="包含匹配"><a href="#包含匹配" class="headerlink" title="包含匹配"></a>包含匹配</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011094008.png" alt="image-20201004155335138" style="zoom:67%;" />





<h3 id="基础正则"><a href="#基础正则" class="headerlink" title="基础正则"></a>基础正则</h3><p>包含匹配，规则越准确，匹配内容越少</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011094012.png" alt="image-20201004193504902" style="zoom: 67%;" />

<p>*<strong>和.</strong></p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;a*&quot; file			a重复0次或一次，其实无意义，无论有无均可匹配</span><br><span class="line">grep &quot;aa*&quot;	file		匹配至少有一个a的行</span><br><span class="line">grep &quot;s..d&quot;	file		匹配含s_ _d的行</span><br><span class="line">grep &quot;s.*d&quot; file			匹s----...-d的所有内容</span><br><span class="line">grep &quot;.*&quot; file			匹配任意字符</span><br></pre></td></tr></table></figure>

<p><strong>^和$</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;^M&quot; file			匹配以M开头的行</span><br><span class="line">grep &quot;n$&quot; file			匹配以n结尾的行</span><br><span class="line">grep &quot;^$&quot; file			匹配空白行\</span><br><span class="line">grep -n &quot;^$&quot; file		-n显示行号</span><br></pre></td></tr></table></figure>
<p><strong>[]</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -n &quot;s[ao]id&quot; file		匹配含said或soid的行</span><br><span class="line">grep -n &quot;[0-9]&quot; file			匹配任意一个数字</span><br><span class="line">grep -n &quot;^[a-z]&quot; file			匹配任意小写字母开头的行</span><br></pre></td></tr></table></figure>
<p><strong>[^]</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -n &quot;^[^a-zA-Z]&quot; file			匹配非字母</span><br></pre></td></tr></table></figure>
<p><strong>\</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;\.$&quot; file			匹配以.结尾的行</span><br></pre></td></tr></table></figure>
<p><strong>\{n\}</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;a\&#123;3\&#125;&quot;	file	匹配a连续出现3次的行</span><br><span class="line">grep &quot;[0-9]\&#123;3\&#125;&quot;	file	匹配数字连续出现3次的行(超过也会包含)</span><br></pre></td></tr></table></figure>
<p><strong>\{n,\}</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;^[0-9]\&#123;3,\&#125;[a-z]&quot;	file	匹配数字开头连续出现超过3次的行</span><br></pre></td></tr></table></figure>
<p><strong>\{n,m\}</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;sa\&#123;1,3\&#125;i&quot; file		匹配s和i之间a出现至少1此至多3次的行</span><br></pre></td></tr></table></figure>





<h2 id="字符截取命令"><a href="#字符截取命令" class="headerlink" title="字符截取命令"></a>字符截取命令</h2><h3 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h3><p>cut提取列，grep提取行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cut [选项] file</span><br><span class="line">		-f 列号			提取第几列</span><br><span class="line">		-d 分隔符		按照指定分隔符分割列</span><br></pre></td></tr></table></figure>
<p>读取文件某列(分隔符默认tab)</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013094938.png" alt="image-20201013094938332" style="zoom:67%;" />

<p>指定分隔符读取</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013095042.png" alt="image-20201013095042047" style="zoom:50%;" />

<p>以<code>:</code>为分隔符取第一三列即用户名和uid</p>
<h5 id="cut-grep"><a href="#cut-grep" class="headerlink" title="cut+grep"></a>cut+grep</h5><p>下面是一个获取普通用户用户名的例子，普通用户shell为/bin/bash</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011094005.png" alt="image-20201004150004628" style="zoom:50%;" />



<h5 id="局限"><a href="#局限" class="headerlink" title="局限"></a>局限</h5><p>分隔符：制表符tab，确切的符号，。：等可很好的匹配</p>
<p>如果是空格，可能有影响</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011094011.png" alt="image-20201004181605979" style="zoom:67%;" />

<p>awk可以解决这个问题，但使用较为复杂，建议优先cut,不能解决再寻求awk</p>
<h3 id="printf-严格上说不算截取命令"><a href="#printf-严格上说不算截取命令" class="headerlink" title="printf(严格上说不算截取命令)"></a>printf(严格上说不算截取命令)</h3><h5 id="格式化打印"><a href="#格式化打印" class="headerlink" title="格式化打印"></a>格式化打印</h5><p>awk中最常见的打印输出字符串命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;输出类型输出格式&#x27; 输出内容</span><br><span class="line">				%ns		字符串，n指数量</span><br><span class="line">				%ni		整数</span><br><span class="line">				%m,nf	浮点数/小数，m和n是数字，m=整数位数+小数位数,n=小数位数。</span><br><span class="line">							eg. 8.2f表示共输出8位数，其中2位是小数</span><br><span class="line">				\a		警告音			\b	退格/向左删除</span><br><span class="line">				\f		清除屏幕		\n	换行</span><br><span class="line">				\r		回车				\t	水平制表符/tab</span><br><span class="line">				\v		垂直制表符</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013095652.png" alt="image-20201013095652228" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf %s 1 2 3 4 5 6			</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>

<p>对输出内容使用%s格式化输出,一次处理一个字符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf %s %s %s 1 2 3 4 5 6			</span><br><span class="line"><span class="meta">%</span><span class="bash">s%s123456</span></span><br></pre></td></tr></table></figure>

<p>多于1个输出格式应使用’’或””括起来，否则会识别第一个，并将后续格式当作输出内容处理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;%s %s %s&#x27; 1 2 3 4 5 6			</span><br><span class="line">1 2 34 5 6		  									#输出 1 2 3为一组4 5 6为一组</span><br><span class="line">printf &#x27;%s %s %s\n&#x27; 1 2 3 4 5 6</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br></pre></td></tr></table></figure>

<p>#对输出内容使用%s %s %s格式,一次处理三个字符</p>
<h5 id="命令结果的格式化输出"><a href="#命令结果的格式化输出" class="headerlink" title="命令结果的格式化输出"></a>命令结果的格式化输出</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013100131.png" alt="image-20201013100131097" style="zoom:67%;" />

<p>printf不能打印文件内容,也不能使用管道符接收输出内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;%s&#x27; stu.txt			#不会直接识别文件</span><br><span class="line">cat stu.txt|printf &#x27;%s&#x27;		#不能使用管道符接收输出内容</span><br></pre></td></tr></table></figure>
<p>需将查看文件命令作为变量传入<code>$()</code>,文件内容以字符串形式输出,不包含特殊字符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;%s&#x27; $(cat stu.txt)		#将命令结果作为变量$(命令)</span><br><span class="line">IDNamegenderMark1LimingM862ScM903GaoM83</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;%s\t%s\t%s\t%s\n&#x27; $(cat stu.txt)	#调整格式</span><br><span class="line">ID      Name    gender  Mark</span><br><span class="line">1       Liming  M       86</span><br><span class="line">2       Sc      M       90</span><br><span class="line">3       Gao     M       83</span><br></pre></td></tr></table></figure>

<p>awk支持print和printf，print默认结尾换行（Linux中默认没有print）</p>
<h3 id="awk-复杂版列提取）"><a href="#awk-复杂版列提取）" class="headerlink" title="awk(复杂版列提取）"></a>awk(复杂版列提取）</h3><h4 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;条件1 &#123;动作1&#125; 条件2 &#123;动作2&#125; 条件3 &#123;动作3&#125; 条件4 &#123;动作4&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">一般使用关系表达式作为条件,eg:</span><br><span class="line"><span class="meta">x&gt;</span><span class="bash">10		x&gt;=10		x&lt;=</span></span><br></pre></td></tr></table></figure>



<p><strong>动作：</strong></p>
<ol>
<li><p>格式化输出</p>
</li>
<li><p>流程控制语句</p>
</li>
</ol>
<p>感觉像一个一句话版的if-else，（过滤）条件可省略，指所有</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013100801.png" alt="image-20201013100801711" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;printf $2 &quot;\t&quot; $4 &quot;\n&quot;&#125;&#x27; stu.txt </span><br></pre></td></tr></table></figure>

<ul>
<li>awk支持<code>&#39;&#39;</code>, 也支持<code>&quot;&quot;</code>,注意避免同类型重复嵌套造成意外闭合</li>
<li>未设定过滤条件，表示对所有数据格式化输出</li>
<li>处理数据时读入一行-格式化-读入下一行。。。文件结尾</li>
</ul>
<h4 id="awk-amp-cut"><a href="#awk-amp-cut" class="headerlink" title="awk &amp; cut"></a>awk &amp; cut</h4><p>之所以需要awk是因为cut不能很好处理分隔符为空格的内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h | awk &#x27;&#123;print $1 &quot;\t&quot; $5 &quot;\t&quot; $6&#125;&#x27;</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013100957.png" alt="image-20201013100957892" style="zoom:67%;" />

<ul>
<li>系统命令中只有printf,没有print。但在awk中都可用</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013101121.png" alt="image-20201013101121875" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h |grep sda2|awk &#x27;&#123;print $5&#125;&#x27;|cut -d &quot;%&quot; -f 1</span><br></pre></td></tr></table></figure>

<ul>
<li>首先查询分区状况,找到含sda2的列,取第5 行,以%作为分隔符,取第一部分得到分区使用率</li>
</ul>
<h4 id="BEGIN标记"><a href="#BEGIN标记" class="headerlink" title="BEGIN标记"></a>BEGIN标记</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;printf&quot;This is a transcript \n&quot;&#125; &#123;print $2 &quot;\t&quot; $6&#125;&#x27; stu.txt</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013101502.png" alt="image-20201013101502351" style="zoom:67%;" />

<p>BEGIN表示在读取数据之前先执行BEGIN后{动作}</p>
<h4 id="指定分隔符"><a href="#指定分隔符" class="headerlink" title="指定分隔符"></a>指定分隔符</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;FS=&quot;:&quot;&#125; &#123;print $1 &quot;\t\t\t&quot; $3&#125;&#x27; /etc/passwd </span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013101645.png" alt="image-20201013101645334" style="zoom:67%;" />
由于awk先读取数据后执行动作所以在指定分隔符之前数据已经读入，所以未被处理
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;print $1 &quot;\t\t\t&quot; $3&#125;&#x27;  /etc/passwd</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013101853.png" alt="image-20201013101853284" style="zoom:67%;" />

<h4 id="END标记"><a href="#END标记" class="headerlink" title="END标记"></a>END标记</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;print $1 &quot;\t\t\t&quot; $3&#125; END&#123;print &quot;aaaaaaa&quot;&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013102037.png" alt="image-20201013102037884"></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013102102.png" alt="image-20201013102102768" style="zoom:60%;" />



<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat stu.txt|grep -v Name|awk &#x27;$4&gt;85 &#123;print $2&#125;&#x27; </span><br></pre></td></tr></table></figure>

<p>如果第4列&gt;85则输出第2列</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013102305.png" alt="image-20201013102305102" style="zoom:67%;" />

<h4 id="awk-amp-grep"><a href="#awk-amp-grep" class="headerlink" title="awk&amp;grep"></a>awk&amp;grep</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT 192.168.72.88 |grep tcp |grep ssh|awk &#x27;&#123;print $2&#125;&#x27;</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013110201.png" alt="image-20201013110201813" style="zoom:67%;" />



<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><p>轻量流编辑器，用于将数据选取，替换，删除，新增命令</p>
<h4 id="区别于vi"><a href="#区别于vi" class="headerlink" title="区别于vi"></a>区别于vi</h4><ul>
<li>vi不能修改命令结果里的内容，除非先将结果保存到文件</li>
</ul>
<ul>
<li>sed可用管道符接受内容进行修改</li>
</ul>
<h4 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed [选项] &#x27;[动作]&#x27; file</span><br><span class="line">选项：</span><br><span class="line">		-n:将经sed处理的行输出到屏幕(默认输出所有)</span><br><span class="line">		-e:允许对输入数据应用多条sed命令编辑</span><br><span class="line">		-i:由sed的修改结果直接修改读取数据的文件而不是由屏幕输出</span><br><span class="line">动作：</span><br><span class="line">		a :追加，在当前行后添加一行或多行，添加多行时除最后行每行末尾需用&quot;\&quot;表示数据未完结</span><br><span class="line">		c \:行替换，用c后字符替换原行，多行替换时行末加\表示未完结</span><br><span class="line">		i \:插入当前行前插入，多行插入行末\</span><br><span class="line">		d:	删除指定行</span><br><span class="line">		p:  打印输出指定行</span><br><span class="line">		s:	字串替换，&quot;行范围s/oldstr/newstr/g&quot;	类似vim替换格式</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<ul>
<li>不建议使用-i直接对文件进行修改，sed主要用于处理文件命令输出，修改可用vi(m)</li>
</ul>
<h4 id="输出实例"><a href="#输出实例" class="headerlink" title="输出实例:"></a>输出实例:</h4><h5 id="输出p"><a href="#输出p" class="headerlink" title="输出p"></a><strong>输出p</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;2p&#x27; stu.txt 			</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013104559.png" alt="image-20201013103404965" style="zoom:50%;" />

<p>输出第二行,其余行是文件本身输出.要想只输出sed处理的内容,需添加-n参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#x27;2p&#x27; stu.txt 				#-n只输出处理内容</span><br></pre></td></tr></table></figure>

<h5 id="删除d"><a href="#删除d" class="headerlink" title="删除d"></a><strong>删除d</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;2,4d&#x27; stu.txt 			#删除第2到4行</span><br><span class="line">sed &#x27;2,3d&#x27; stu.txt  			#不影响源文件，加-i直接作用于文件结果</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013103659.png" alt="image-20201013103659734" style="zoom:67%;" />

<p>注意这里删除只作用于命令结果,不会影响源文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013103755.png" alt="image-20201013103755582" style="zoom:50%;" />

<h5 id="行后追加a"><a href="#行后追加a" class="headerlink" title="行后追加a"></a><strong>行后追加a</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;2a hello&#x27; stu.txt </span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013103943.png" alt="image-20201013103943679" style="zoom:67%;" />

<h5 id="行前插入i"><a href="#行前插入i" class="headerlink" title="行前插入i"></a><strong>行前插入i</strong></h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013104137.png" alt="image-20201013104137089" style="zoom:67%;" />



<h5 id="行替换c"><a href="#行替换c" class="headerlink" title="行替换c"></a>行替换c</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;2c No person&#x27; stu.txt </span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013104446.png" alt="image-20201013104446117" style="zoom:67%;" />

<p>同样不影响源文件</p>
<h5 id="行内字符替换s"><a href="#行内字符替换s" class="headerlink" title="行内字符替换s"></a>行内字符替换s</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;4s/83/100/g&#x27; stu.txt  		#第4行83改为100</span><br><span class="line">sed -e &#x27;s/Liming//g;s/Sc//g&#x27; stu.txt     #将Liming和Sc替换为空    </span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013104713.png" alt="image-20201013104712938" style="zoom:50%;" />



<h2 id="字符处理命令"><a href="#字符处理命令" class="headerlink" title="字符处理命令"></a>字符处理命令</h2><h3 id="排序sort"><a href="#排序sort" class="headerlink" title="排序sort"></a>排序sort</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sort [选项] file</span><br><span class="line">			-f		忽略大小写</span><br><span class="line">			-n		数值型排序，默认字符串型</span><br><span class="line">			-r		反向排序</span><br><span class="line">			-t		指定分隔符，默认tab</span><br><span class="line">			-k,n[,m]	按指定字段范围排序，从n到m,默认到行尾</span><br></pre></td></tr></table></figure>

<p>一般使用<code>sort 文件名</code>或者管道符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort /etc/passwd</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013104835.png" alt="image-20201013104835673" style="zoom: 50%;" />

<p>指定分隔符和排序字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -t &quot;:&quot; -k 3,3 /etc/passwd</span><br></pre></td></tr></table></figure>

<p>以:作分隔符,按照第三列排序</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013105053.png" alt="image-20201013105053702" style="zoom:50%;" />

<p>由于默认按照字符型排序所以比较字符串首位ASCII大小,相同则比较第二位,以此类推.1001在2之前</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -t &quot;:&quot; -k 3,3 /etc/passwd -n</span><br></pre></td></tr></table></figure>

<h3 id="统计wc"><a href="#统计wc" class="headerlink" title="统计wc"></a>统计wc</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wc [选项] file</span><br><span class="line">		-l:只统计行数</span><br><span class="line">		-w:只统计单词数</span><br><span class="line">		-m:只统计字符数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wc /etc/passwd</span><br><span class="line">wc -l /etc/passwd</span><br><span class="line">wc -w /etc/passwd</span><br><span class="line">wc -m /etc/passwd</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013105423.png" alt="image-20201013105423397" style="zoom:67%;" />

<p>可使用管道符统计命令输出</p>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><h3 id="常用判断语句格式"><a href="#常用判断语句格式" class="headerlink" title="常用判断语句格式"></a>常用判断语句格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ 判断语句 ]&amp;&amp;echo yes||echo no</span><br><span class="line">或</span><br><span class="line">test 判断语句 &amp;&amp;echo yes||echo no</span><br></pre></td></tr></table></figure>

<p><code>test 判断语句</code>不常用于脚本，不过看个人使用习惯</p>
<p>一般在脚本中使用格式2<code>[ xxx -e file ]</code>， 注意[ ]两侧的空格</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ -d /root ]&amp;&amp; echo yes ||echo no</span><br><span class="line">yes</span><br></pre></td></tr></table></figure>

<p>执行过程：扫描-分区-判断存在</p>
<h4 id="文件类型判断"><a href="#文件类型判断" class="headerlink" title="文件类型判断"></a>文件类型判断</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013111410.png" alt="image-20201013111410513" style="zoom: 50%;" />

<p>eg:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test -e /root/initial-setup-ks.cfg </span><br><span class="line">[ -e /root/initial-setup-ks.cfg ]</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013111622.png" alt="image-20201013111622229" style="zoom:67%;" />

<p>由于测试没有回显,所以使用<code>$?</code>查看上条命令执行结果,0代表正确执行,其他数字代表对应的错误代码.</p>
<h4 id="判断文件权限"><a href="#判断文件权限" class="headerlink" title="判断文件权限"></a>判断文件权限</h4><p>只能测出大概范围，例如只有ugo中有一人有w权限则判断为真</p>
<h5 id="两个文件之间比较"><a href="#两个文件之间比较" class="headerlink" title="两个文件之间比较"></a>两个文件之间比较</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file1 -nt file2		判断文件1修改时间是否比文件2新，新则1/真</span><br><span class="line">file1 -ot file2		判断----旧</span><br><span class="line">file1 -ef file2		通过比较inode判断是否为同一文件</span><br></pre></td></tr></table></figure>

<ul>
<li><p>硬链接inode一致，软连接不一致。</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013113327.png" alt="image-20201013113327752"></p>
<p>一般情况下，文件名和 inode 号是一一对应，但是也有可能多个文件名指向同一个 inode 号，即硬链接。硬链接可以实现用不同的文件名访问同一个文件；对文件内容修改，会影响到所有的文件名；但是，删除一个文件名，不影响其他文件名的访问。</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013113239.png" alt="image-20201013113239611"></p>
</li>
</ul>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ hello.sh -ef sh_hardlink.sh ]&amp;&amp;echo yes||echo no     </span><br></pre></td></tr></table></figure>

<h5 id="整数大小比较"><a href="#整数大小比较" class="headerlink" title="整数大小比较"></a>整数大小比较</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">整数1 -eq 整数2			判断数1=数2?,相等则真</span><br><span class="line">整数1 -ne 整数2			判断数1=数2?,不相等则真</span><br><span class="line"></span><br><span class="line">整数1 -gt 整数2			判断数1&gt;数2?,&gt;则真</span><br><span class="line">整数1 -lt 整数2			判断数1&lt;数2?,&lt;则真</span><br><span class="line"></span><br><span class="line">整数1 -ge 整数2			判断数1&gt;=数2?,&gt;=则真</span><br><span class="line">整数1 -le 整数2			判断数1&lt;=数2?,&lt;=则真</span><br></pre></td></tr></table></figure>

<h5 id="字串比较"><a href="#字串比较" class="headerlink" title="字串比较"></a>字串比较</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-z str			判断字符串是否为空，空则真</span><br><span class="line">-n str			判断字符串是否非空，非空则真</span><br><span class="line"></span><br><span class="line">str1==str2		相等则真</span><br><span class="line">str1!=str2		不等则真</span><br></pre></td></tr></table></figure>

<p>判断是否为空十分常用–脚本中检测用户输入</p>
<h5 id="多重条件判断"><a href="#多重条件判断" class="headerlink" title="多重条件判断"></a>多重条件判断</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">判断1 -a 判断2		逻辑与，都成立则真</span><br><span class="line">判断1 -o 判断2		逻辑或，有1个真则真</span><br><span class="line">！判断						 逻辑非，判断结果取反</span><br></pre></td></tr></table></figure>



<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><h4 id="单分支格式-if-then"><a href="#单分支格式-if-then" class="headerlink" title="单分支格式 if-then"></a>单分支格式 if-then</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if [ 条件判断式 ];then</span><br><span class="line">	程序</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line">if [ 条件判断式 ]</span><br><span class="line">then</span><br><span class="line">	程序</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>这里的[  ]就是test判断格式2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">统计根分区使用率iftest1.sh</span></span><br><span class="line"></span><br><span class="line">rate=$(df -h | grep &quot;/dev/sda2&quot;|awk &#x27; &#123;print $5&#125;&#x27; | cut -d &quot;%&quot; -f 1)</span><br><span class="line"></span><br><span class="line">if [ $rate -ge 80 ]</span><br><span class="line">        then</span><br><span class="line">                echo &#x27;Warning!/dev/sda2 is full!!&#x27;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013114143.png" alt="image-20201013114143168" style="zoom: 67%;" />

<h4 id="双分支-if-then-else"><a href="#双分支-if-then-else" class="headerlink" title="双分支 if-then-else"></a>双分支 if-then-else</h4><p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [ 条件判断式 ]</span><br><span class="line">  then</span><br><span class="line">    程序</span><br><span class="line">  else</span><br><span class="line">    程序</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">备份mysql数据库</span></span><br><span class="line"></span><br><span class="line">ntpdate asia.pool.ntp.org &amp;&gt;/dev/null</span><br><span class="line"><span class="meta">#</span><span class="bash">同步系统时间</span></span><br><span class="line">date=$(date +%y%m%d)    #提取年月日</span><br><span class="line">size=$(du -sh /var/lib/mysql)           #统计数据库大小并记录</span><br><span class="line">if [ -d /tmp/dbbak ]</span><br><span class="line">        then </span><br><span class="line">                echo &quot;Date:$date!&quot;&gt;/tmp/dbbak/dbinfo.txt</span><br><span class="line">                echo &quot;Data size: $size&quot; &gt;&gt; /tmp/dbbak/dbinfo.txt</span><br><span class="line">                cd /tmp/dbbak</span><br><span class="line">                tar -zcf mysql-lib-$date.tar.gz /var/lib/mysql dbinfo &amp;&gt;/dev/null			</span><br><span class="line">                #文件不会覆盖,日期做后缀</span><br><span class="line">                rm -rf /tmp/dbbak/dbinfo.txt</span><br><span class="line">        else</span><br><span class="line">                mkdir /tmp/dbbak</span><br><span class="line">                echo &quot;Date:$date!&quot;&gt;/tmp/dbbak/dbinfo.txt</span><br><span class="line">                echo &quot;Data size: $size&quot; &gt;&gt; /tmp/dbbak/dbinfo.txt</span><br><span class="line">                cd /tmp/dbbak</span><br><span class="line">                tar -zcf mysql-lib-$date.tar.gz /var/lib/mysql dbinfo &amp;&gt;/dev/null</span><br><span class="line">                rm -rf /tmp/dbbak/dbinfo.txt</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">判断apache是否启动</span></span><br><span class="line">port=$(nmap -sT 192.168.1.156|grep tcp|grep http|awk &#x27; &#123;print $2&#125;&#x27;)</span><br><span class="line"><span class="meta">#</span><span class="bash">使用nmap扫描服务器，截取apache服务状态，赋予port</span></span><br><span class="line">if [ $port==&quot;open&quot; ]</span><br><span class="line">	then</span><br><span class="line">			echo &quot;$(date) httpd is OK.&quot;&gt;&gt;/tmp/autostart-acc.log</span><br><span class="line">	else</span><br><span class="line">			/etc/rc.d/init.d/httpd restart &amp;&gt; /dev/null</span><br><span class="line">			echo &quot;$(date) restart httpd.&quot; &gt;&gt; /tmp/autostart-err.log</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<ul>
<li>有时用ps判断不准确，可能apache启动但不显示服务，不能确定是否可以正常连接</li>
<li>netstat同上</li>
<li>nmap可连接apache证明打开<a target="_blank" rel="noopener" href="https://crayon-xin.github.io/2018/08/12/nmap%E8%B6%85%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">nmap使用指南</a></li>
</ul>
<h4 id="多分支-if-then-elif-then…-else"><a href="#多分支-if-then-elif-then…-else" class="headerlink" title="多分支 if-then-elif-then…-else"></a>多分支 if-then-elif-then…-else</h4><p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if [ 条件判断式1 ]</span><br><span class="line">  then		#1成立，执行，不成立执行elif判断2</span><br><span class="line">    程序</span><br><span class="line">elif [ 条件判断式2 ]</span><br><span class="line">	then		#2成立执行，不成立-判断3</span><br><span class="line">		程序</span><br><span class="line">elif [ 条件判断式3 ]</span><br><span class="line">	then</span><br><span class="line">		程序</span><br><span class="line">    ...</span><br><span class="line">  else			#所有条件均不成立，执行此程序</span><br><span class="line">    程序</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">read -p &quot;Please input a filename: &quot; file</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$file</span>=输入的文件名</span></span><br><span class="line">if [ -z &quot;$file&quot; ]		#是否空</span><br><span class="line">	then</span><br><span class="line">		echo &quot;Error,Please input a filename: &quot;</span><br><span class="line">		exit 1</span><br><span class="line">elif [ ! -e &quot;$file&quot;]#是否存在</span><br><span class="line">	then </span><br><span class="line">		echo &quot;Your input is not a file&quot;</span><br><span class="line">		exit 2</span><br><span class="line">elif [ -f &quot;$file&quot; ]</span><br><span class="line">	then</span><br><span class="line">		echo &quot;$file is a regulare file!&quot;</span><br><span class="line">elif [ -d &quot;$file&quot; ]</span><br><span class="line">	then</span><br><span class="line">		echo &quot;$file is a regulare directory!&quot;</span><br><span class="line">else</span><br><span class="line">		echo &quot;$file is an other file!&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>



<h3 id="case多分支条件判断语句"><a href="#case多分支条件判断语句" class="headerlink" title="case多分支条件判断语句"></a>case多分支条件判断语句</h3><p>与if…elif..else区别:if能判断多种条件关系，case语句只能判断一种条件关系</p>
<p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">case $变量名 in</span><br><span class="line">	&quot;值1&quot;)</span><br><span class="line">			变量==值1则执行程序1</span><br><span class="line">			;;</span><br><span class="line">	&quot;值2&quot;)</span><br><span class="line">			如果变量值==值2，执行程序2</span><br><span class="line">			;;</span><br><span class="line">		...</span><br><span class="line">			;;</span><br><span class="line">		*)</span><br><span class="line">			如果变量值都不是以上值，执行此程序</span><br><span class="line">			;;</span><br><span class="line">esac</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">判断用户输入</span></span><br><span class="line">read -p &quot;please choose yes/no:&quot; -t 30 cho</span><br><span class="line">case $cho in</span><br><span class="line">	&quot;yes&quot;)</span><br><span class="line">			echo &quot;your choice is yes!&quot;</span><br><span class="line">			;;</span><br><span class="line">	&quot;no&quot;)</span><br><span class="line">			echo &quot;your choice is no!&quot;</span><br><span class="line">			;;</span><br><span class="line">	*)</span><br><span class="line">			echo &quot;your choose is error!&quot;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------</span><br><span class="line">[root@localhost sh]# bash casetest1.sh</span><br><span class="line">please choose yes/no:yes</span><br><span class="line">your choice is yes!</span><br><span class="line">[root@localhost sh]# bash casetest1.sh </span><br><span class="line">please choose yes/no:aa</span><br><span class="line">your choose is error!</span><br></pre></td></tr></table></figure>



<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><h4 id="不确定循环次数"><a href="#不确定循环次数" class="headerlink" title="不确定循环次数"></a>不确定循环次数</h4><p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for 变量 in 值1 值2 值3...</span><br><span class="line">	do</span><br><span class="line">		程序</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>

<p><strong>实例:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">打印时间</span></span><br><span class="line">for time in morning noon afternoon evening</span><br><span class="line">	do</span><br><span class="line">			echo &quot;this time is $time!&quot;</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013114833.png" alt="image-20201013114833901" style="zoom: 67%;" />

<p>不确定循环次数的for循环应用，灵活</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">批量解压缩脚本</span></span><br><span class="line">cd /lamp</span><br><span class="line">ls *.tar.gz &gt; ls.log</span><br><span class="line">for i in $(cat ls.log)</span><br><span class="line">	do</span><br><span class="line">		tar -zxf $i &amp;&gt;/dev/null</span><br><span class="line">	done</span><br><span class="line">rm -rf /lamp/ls.log</span><br></pre></td></tr></table></figure>

<h4 id="指定循环次数"><a href="#指定循环次数" class="headerlink" title="指定循环次数"></a>指定循环次数</h4><p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for((初始值;循环控制条件;变量变化))</span><br><span class="line">	do</span><br><span class="line">		程序</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">从1加到100</span></span><br><span class="line">s=0</span><br><span class="line">for((i=1;i&lt;100;i=i+1))</span><br><span class="line">	do</span><br><span class="line">		s = $(($s+$i))</span><br><span class="line">	done</span><br><span class="line">echo &quot;the sum of 1+2+3...+100 is : $s&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">批量添加用户</span></span><br><span class="line">read -p &quot;please input username: &quot; -t 30 name</span><br><span class="line">read -p &quot;please input count: &quot; -t 20 counts</span><br><span class="line">read -p &quot;please input password: &quot; -t 20 pass</span><br><span class="line"></span><br><span class="line">if [ ! -z &quot;$name&quot; -a ! -z &quot;$counts&quot; -a ! -z &quot;$pass&quot; ]                      #-z判断是否为空，-a与，3个全不空则为真</span><br><span class="line">        then</span><br><span class="line">                y=$(echo $counts | sed &#x27;s/[0-9]//g&#x27;)                       #判断num是否是数字，将数字替换为空</span><br><span class="line">                if [ -z &quot;$y&quot; ]          #空则证明是数字</span><br><span class="line">                        then</span><br><span class="line">                                for(( i=1;i&lt;=$counts;i=i+1 ))</span><br><span class="line">                                        do</span><br><span class="line">                                                useradd &quot;$name$i&quot; &amp;&gt;/dev/null</span><br><span class="line">                                                echo $pass | passwd --stdin &quot;$nmae$i&quot; &amp;&gt;/dev/null</span><br><span class="line">                                        done</span><br><span class="line">                fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013115418.png" alt="image-20201013115418045" style="zoom: 67%;" />



<h3 id="while循环与until循环"><a href="#while循环与until循环" class="headerlink" title="while循环与until循环"></a>while循环与until循环</h3><h4 id="while不定-条件循环"><a href="#while不定-条件循环" class="headerlink" title="while不定/条件循环"></a>while不定/条件循环</h4><p>循环会一直继续至条件不成立</p>
<p><strong>格式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while [ 条件判断式 ]</span><br><span class="line">	do</span><br><span class="line">		程序</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1加到100</span></span><br><span class="line"></span><br><span class="line">i=1</span><br><span class="line">s=0</span><br><span class="line">while [ $i -le 100 ]		#小于等于100</span><br><span class="line">	do</span><br><span class="line">		s=$(($s+$i))</span><br><span class="line">		i=$(($i+1))</span><br><span class="line">	done</span><br><span class="line">echo &quot;the num is :$s&quot;</span><br></pre></td></tr></table></figure>



<h4 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a>until循环</h4><p>与while相反，表达式不成立执行循环至表达式成立，终止</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1加到100</span></span><br><span class="line"></span><br><span class="line">i=1</span><br><span class="line">s=0</span><br><span class="line">until [ $i -gt 100 ]		#知道大于100结束</span><br><span class="line">	do</span><br><span class="line">		s=$(($s+$i))</span><br><span class="line">		i=$(($i+1))</span><br><span class="line">	done</span><br><span class="line">echo &quot;the num is :$s&quot;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">line=$(wc -l t2.sh|cut -f 1 -d &quot; &quot;) #行数</span><br><span class="line">cow= $(cat t2.sh |awk &quot;END&#123;print NF&#125;&quot;)#列数</span><br><span class="line">for((j=0;j&lt;cow;j++))</span><br><span class="line">	do</span><br><span class="line">			for((i=0;i&lt;line;i++))</span><br><span class="line">				do</span><br><span class="line">					echo &quot;$(cut -d &quot; &quot; -f $j t2.sh | sed -n &#x27;$i&#x27;p)&quot;</span><br><span class="line">					echo &quot; &quot;</span><br><span class="line">				done</span><br><span class="line">				echo -e &quot;\n&quot;</span><br><span class="line">	done</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-4-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-4-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux基础_4.权限管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:22:17" itemprop="dateCreated datePublished" datetime="2020-10-11T09:22:17+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:14" itemprop="dateModified" datetime="2020-10-13T12:58:14+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h3 id="ACL权限"><a href="#ACL权限" class="headerlink" title="ACL权限"></a>ACL权限</h3><p>Access Control List (访问控制列表）它在UGO权限管理的基础上为文件系统提供额外的、更灵活的权限管理机制。ACL允许你给任何的用户或用户组设置任何文件/目录的访问权限。</p>
<h4 id="查看分区ACL权限是否开启"><a href="#查看分区ACL权限是否开启" class="headerlink" title="查看分区ACL权限是否开启"></a>查看分区ACL权限是否开启</h4><ol>
<li><p>查看分区</p>
<p><code>df -h</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012085002.png" alt="image-20201012085002549" style="zoom:50%;" />
</li>
<li><p>查看ACL权限</p>
<p><code> dumpe2fs -h /dev/sda2</code>  查看分区情况</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012085102.png" alt="image-20201012085102883" style="zoom: 67%;" />

</li>
</ol>
<h5 id="临时开启分区ACL权限"><a href="#临时开启分区ACL权限" class="headerlink" title="临时开启分区ACL权限"></a>临时开启分区ACL权限</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,acl /#重新挂载根分区，并加入ACL权限</span><br></pre></td></tr></table></figure>

<h5 id="永久生效"><a href="#永久生效" class="headerlink" title="永久生效"></a>永久生效</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.修改/etc/fstab文件，加,acl</span><br><span class="line">UUID=910dedc7-2b9e-4e2b-a82e-db2dda090854 /      xfs     defaults,acl       0 0</span><br><span class="line">2.重新挂载mount -o remount /或重启系统</span><br></pre></td></tr></table></figure>



<h4 id="设定与查看ACL权限"><a href="#设定与查看ACL权限" class="headerlink" title="设定与查看ACL权限"></a>设定与查看ACL权限</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setfacl 选项 文件名</span><br><span class="line">				-m	设定ACL权限</span><br><span class="line">				-x	删除指定的ACL权限</span><br><span class="line">				-b  删除所有的ACL权限</span><br><span class="line">				-d  设定默认的ACL权限</span><br><span class="line">				-k	删除默认--</span><br><span class="line">				-R  递归设定ACL权限</span><br></pre></td></tr></table></figure>



<p>   假设：</p>
   <img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093904.png" alt="image-20200925220231761" style="zoom: 50%;" />

<p>   设置下条件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012090401.png" alt="image-20201012090401137" style="zoom: 50%;" />

<h5 id="为用户设定ACL权限"><a href="#为用户设定ACL权限" class="headerlink" title="为用户设定ACL权限"></a>为用户设定ACL权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m  u:用户名:权限 文件名</span><br></pre></td></tr></table></figure>

<p><code>setfacl -m u:st:rx project/    </code></p>
<h5 id="为组分配ACL权限"><a href="#为组分配ACL权限" class="headerlink" title="为组分配ACL权限"></a>为组分配ACL权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m  g:组名:权限 文件名</span><br></pre></td></tr></table></figure>

<p><code>setfacl -m g:tgroup2:rwx project/    </code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012090729.png" alt="image-20201012090729017" style="zoom:50%;" />

<ul>
<li><p>最大权限mask</p>
<p>修改mask权限，不影响所有者权限（user），影响ACL权限(st)和其所属组权限(tgroup,tgroup2)</p>
</li>
</ul>
<h5 id="调整最大用户权限mask"><a href="#调整最大用户权限mask" class="headerlink" title="调整最大用户权限mask"></a>调整最大用户权限mask</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m m:权限 目录&#x2F;文件</span><br></pre></td></tr></table></figure>

<p><code>setfacl -m m:rx project/</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012091051.png" alt="image-20201012091051325" style="zoom:50%;" />



<h5 id="删除ACL权限"><a href="#删除ACL权限" class="headerlink" title="删除ACL权限"></a>删除ACL权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setfacl -x u:用户名 文件</span><br><span class="line">        -x g:组名 文件</span><br><span class="line">        -b	文件	删除文件下所有ACL权限</span><br></pre></td></tr></table></figure>

<p><code> setfacl -x g:tgroup2 project</code>        删除组tgroup2的ACL权限</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012091550.png" alt="image-20201012091549977" style="zoom:50%;" />

<p><code> setfacl -b project/</code>                删除project下所有ACL权限</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012091733.png" alt="image-20201012091733107" style="zoom:50%;" />

<p>文件夹有ACL权限时，会有一个+</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012091834.png" alt="image-20201012091834906" style="zoom:50%;" />  

<h5 id="递归设定ACL权限"><a href="#递归设定ACL权限" class="headerlink" title="递归设定ACL权限"></a>递归设定ACL权限</h5><p>   父目录设定ACL，子目录和子文件也会拥有相同ACL权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m u:用户名:权限 -R 文件名&#x2F;目录</span><br></pre></td></tr></table></figure>

<p><code>setfacl -m u:st:rx -R project/ </code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012092303.png" alt="image-20201012092302987" style="zoom: 50%;" />

<p>假设在project目录递归创建ACL权限后，该目录下所有子目录文件均受影响但是对于新创建的文件不受影响。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012093412.png" alt="image-20201012093412373" style="zoom:50%;" />

<h5 id="设定默认ACL权限"><a href="#设定默认ACL权限" class="headerlink" title="设定默认ACL权限"></a>设定默认ACL权限</h5><p>新建文件/目录遵守父目录ACL权限设定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m d:u:用户名：权限 文件名		#d:default	新文件遵守父目录权限</span><br></pre></td></tr></table></figure>

<p><code> setfacl -m d:u:st:rx -R project/</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012093926.png" alt="image-20201012093926601" style="zoom:50%;" />

<p>文件默认没有执行权限，对于目录</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012094533.png" alt="image-20201012094533781" style="zoom: 50%;" />

<p>查看project目录acl权限</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012094157.png" alt="image-20201012094157294" style="zoom: 50%;" />   



<h3 id="文件特殊权限"><a href="#文件特殊权限" class="headerlink" title="文件特殊权限"></a>文件特殊权限</h3><p>查看默认文件权限时显示数字有四位，如下</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012094950.png" alt="image-20201012094950002" style="zoom:67%;" />

<p>后三位与ugo权限有关，反转之后是755(— -w- -w-到rwx r-x r-x)。首位就是特殊权限代表的数字和(SUID４，SGID2，SBIT 1)</p>
<h4 id="SetUID-u-s"><a href="#SetUID-u-s" class="headerlink" title="SetUID: u+s"></a>SetUID: u+s</h4><p>执行者执行时暂时获得文件属主身份（类似sudo root可执行命令）</p>
<p>条件：</p>
<ul>
<li><p>可执行的二进制程序，可设定SUID权限</p>
</li>
<li><p>执行者需对程序有x权限</p>
</li>
<li><p>SUID权限只在执行程序过程中有效</p>
</li>
</ul>
<p>eg. passwd拥有SetUID权限(标志s)，普通用户在执行passwd命令时暂时拥有root权限，将密码写入shadow中</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012095632.png" alt="image-20201012095632654" style="zoom:50%;" />

<p>  cat没有setUID权限，查看shadow文件警告权限不足</p>
<h5 id="设定SUID权限"><a href="#设定SUID权限" class="headerlink" title="设定SUID权限"></a>设定SUID权限</h5>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod 4755 文件名	#设定SUID权限</span><br><span class="line">chmod 755 文件名	#取消SUID权限</span><br><span class="line">或</span><br><span class="line">chmod u+s 文件名</span><br><span class="line">chmod u-s 文件名</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012102143.png" alt="image-20201012102142956"></p>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><ol>
<li>关键目录严格控制写权限，eg./,/usr，/bin</li>
<li>白字红底-错误文件，危险文件，权限过高的文件</li>
<li>错误示范：给vim添加SUID权限，使得普通用户可修改任意文件</li>
<li>对系统中默认应具有SUID权限的文件作一列表，定时检查是否有之外的文件被赋予SUID权限</li>
</ol>
<h4 id="SetGID：g-s"><a href="#SetGID：g-s" class="headerlink" title="SetGID：g+s"></a>SetGID：g+s</h4><p>执行者执行时组身份暂时升级为文件属组身份，针对对象有二进制文件和目录两类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod 2755 文件名</span><br><span class="line">chmod 755 文件名</span><br><span class="line">chmod g+s 文件名</span><br><span class="line">chmod g-s 文件名</span><br></pre></td></tr></table></figure>

<h5 id="针对二进制文件"><a href="#针对二进制文件" class="headerlink" title="针对二进制文件"></a>针对二进制文件</h5><p>可执行的二进制程序，可设定SGID权限</p>
<p>条件：</p>
<ul>
<li>执行者需对程序有x权限</li>
<li>SGID权限只在执行程序过程中有效</li>
</ul>
<p>eg. locate命令。普通用户对locate有执行权限，locate具有SGID权限，普通用户执行locate时，所属组变为slocate,对数据库有r权限，而普通用户对数据库权限为0，命令结束后所属组重新变为原来组</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012102632.png" alt="image-20201012102632928" style="zoom:67%;" />



<h5 id="针对目录"><a href="#针对目录" class="headerlink" title="针对目录"></a>针对目录</h5><p>在此目录有效组会变为目录所属组</p>
<p>条件：</p>
<ul>
<li>普通用户对SGID目录有rx权限，才能进入</li>
<li>普通用户对目录有写权限时，新建文件默认属组为该目录属组</li>
</ul>
<p>实例：</p>
<ol>
<li>创建目录test添加SGID权限，给目录添加写权限。</li>
<li>切换至普通用户jen,jen对目录有rxw权限，可进入，且新建的文件默认属组为test的所属组root</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012103442.png" alt="image-20201012103442141" style="zoom:67%;" />

<ol start="3">
<li>若普通用户对目录不具备rx权限则无法进入目录</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012103934.png" alt="image-20201012103934801" style="zoom: 67%;" />



<h4 id="Sticky-BIT文件黏着位：o-t（针对目录）"><a href="#Sticky-BIT文件黏着位：o-t（针对目录）" class="headerlink" title="Sticky BIT文件黏着位：o+t（针对目录）"></a>Sticky BIT文件黏着位：o+t（针对目录）</h4><p>粘着位，限制普通用户（对root无效）。若普通用户对目录有w权限，只能删除自己建立的文件，不能删除其他用户的文件。</p>
<p>条件：</p>
<ul>
<li>只针对目录有效</li>
<li>普通用户对该目录有wx权限，可写入</li>
<li>粘着位，限制普通用户，对root无效。普通用户有w权限，只能删除自己建立的文件，不能删除其他用户文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod 1755 目录名</span><br><span class="line">chmod 755  目录名</span><br><span class="line">chmod o+t  目录名</span><br><span class="line">chmod o-t  目录名</span><br></pre></td></tr></table></figure>

<p>常见有粘着位的目录-/tmp</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012105847.png" alt="image-20201012104310298" style="zoom: 67%;" />

<p>测试一下：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012104900.png" alt="image-20201012104900395" style="zoom:50%;" />



<h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>特殊权限位 _ugo（第一位）一般不为7，针对对象不同，SUID-二进制文件，SGID-文件/目录，SBIT-针对目录</p>
<h3 id="文件系统属性权限chattr"><a href="#文件系统属性权限chattr" class="headerlink" title="文件系统属性权限chattr"></a>文件系统属性权限chattr</h3><h4 id="设置文件系统属性chattr（文件锁）"><a href="#设置文件系统属性chattr（文件锁）" class="headerlink" title="设置文件系统属性chattr（文件锁）"></a>设置文件系统属性chattr（文件锁）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chattr [+-=][选项] 文件或目录名</span><br><span class="line">+：增加权限</span><br><span class="line">-：删除权限</span><br><span class="line">=：赋予权限</span><br><span class="line">选项：</span><br><span class="line">	+i	针对文件：不允许修改文件(删除，改名，修改数据)，对root有效</span><br><span class="line">		  针对目录：允许 修改目录下文件数据，不允许建立和删除文件</span><br><span class="line">	+a	文件：只能在文件中追加数据(不能使用vi等编辑器，只能使用echo追加)，</span><br><span class="line">					 不能删除修改数据，相当于锁现有数据，可写入</span><br><span class="line">			目录：允许在目录中建立修改文件，不允许删除</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="i-针对文件："><a href="#i-针对文件：" class="headerlink" title="+i 针对文件："></a>+i 针对文件：</h5><p>位文件myfile添加文件锁    <code>chattr +i myfile</code>。不允许再修改文件(删除，改名，修改数据)，对root有效</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012105636.png" alt="image-20201012105636076" style="zoom:60%;" />,</p>
<p>查看权限变化，ll无效，需使用<code>lsattr -a 文件名</code>   </p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012105840.png" alt="image-20201012105840916" style="zoom: 60%;" />

<p>尝试再写入，失败。也无法删除，移动/重命名也不可以。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012110104.png" alt="image-20201012110104175" style="zoom: 50%;" />

<h5 id="i针对目录"><a href="#i针对目录" class="headerlink" title="+i针对目录"></a>+i针对目录</h5><p>对目录project赋予-i权限</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012110456.png" alt="image-20201012110456358" style="zoom:50%;" />

<p>可看到实际上子文件/目录并未获得-i权限，所以可以修改文件内数据，但是无法删除/重命名/移动</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012110901.png" alt="image-20201012110901004" style="zoom:50%;" />

<p>也不可创建文件/目录</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012112018.png" alt="image-20201012112018159" style="zoom:50%;" />

<h5 id="a针对文件"><a href="#a针对文件" class="headerlink" title="+a针对文件"></a>+a针对文件</h5><p>对文件ccc写入内容后，加a权限</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012111308.png" alt="image-20201012111308373" style="zoom: 50%;" />

<p>不可覆盖写入，即不能修改原数据，但可以追加</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012111525.png" alt="image-20201012111525747" style="zoom: 50%;" />

<p>不能使用vim编辑修改，即便是追加</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012111741.png" alt="image-20201012111741503" style="zoom: 50%;" />



<h4 id="查看文件系统属性lsattr"><a href="#查看文件系统属性lsattr" class="headerlink" title="查看文件系统属性lsattr"></a>查看文件系统属性lsattr</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls 选项 文件名</span><br><span class="line">    -a 显示所有文件</span><br><span class="line">    -d 所目标是目录，仅列出目录属性而非子文件</span><br></pre></td></tr></table></figure>

<h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><ol>
<li>sudo操作对象是系统命令,其他-普通文件</li>
<li>root将命令权限赋予普通用户，</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo			#修改/etc/sudoers文件</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012112459.png" alt="image-20201012112459000" style="zoom: 50%;" />

<p>修改格式：</p>
<p>参照</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line"><span class="meta">%</span><span class="bash">wheel  ALL=(ALL)       ALL</span></span><br><span class="line">用户名  被管理主机地址/网段=（转换后可使用身份,默认root）	授权命令(绝对路径)</span><br></pre></td></tr></table></figure>

<ul>
<li>此处被管理ip指允许某用户在登录到该ip的主机上使用任意命令，而非允许源ip是该ip的主机登陆任意主机执行任意命令。定义的是目的ip而非来源ip。</li>
</ul>
<p>实例：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012114115.png" alt="image-20201012112944810" style="zoom:50%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg.</span><br><span class="line">st ALL&#x3D;&#x2F;sbin&#x2F;shutdown -r now	#授权st用户重启服务器</span><br><span class="line">st ALL&#x3D;&#x2F;usr&#x2F;bin&#x2F;vim #vim 权限，实际上慎重赋予普通用户vim权限，转换身份后为root</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012114116.png" alt="image-20201012113045012" style="zoom:50%;" />

<p>此时st用户关机不再需要<code>sudo shutdown -r now</code>    而是直接使用命令<code>shutdown -r now</code></p>
<p><code>sudo -l</code>命令可查看用户被赋予sudo权限的命令,需要输入用户密码</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012114117.png" alt="image-20201012113445584" style="zoom:50%;" />




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux基础_5.文件系统管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:22:17" itemprop="dateCreated datePublished" datetime="2020-10-11T09:22:17+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:18" itemprop="dateModified" datetime="2020-10-13T12:58:18+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="回顾分区与文件系统"><a href="#回顾分区与文件系统" class="headerlink" title="回顾分区与文件系统"></a>回顾分区与文件系统</h2><h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093730.png" alt="image-20201001135647240" style="zoom:50%;" />

<h4 id="分区划分实例"><a href="#分区划分实例" class="headerlink" title="分区划分实例"></a>分区划分实例</h4><h5 id="划分eg1"><a href="#划分eg1" class="headerlink" title="划分eg1"></a>划分eg1</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093731.png" alt="image-20201001140530228" style="zoom:50%;" />

<h5 id="划分eg2"><a href="#划分eg2" class="headerlink" title="划分eg2"></a>划分eg2</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093732.png" alt="image-20201001140838652" style="zoom:50%;" />

<p>即便主分区+扩展分区&lt;4，逻辑分区也只能从sd?5开始</p>
<h5 id="设备文件名命名规则"><a href="#设备文件名命名规则" class="headerlink" title="设备文件名命名规则"></a>设备文件名命名规则</h5><table>
<thead>
<tr>
<th>设备</th>
<th>设备文件名</th>
</tr>
</thead>
<tbody><tr>
<td>IDE硬盘</td>
<td>/dev/hd[a-d]</td>
</tr>
<tr>
<td>SCSI/SATA/USB硬盘</td>
<td>/dev/sd[a-p]</td>
</tr>
<tr>
<td>u盘</td>
<td>/dev/sd[a-p]</td>
</tr>
<tr>
<td>软驱</td>
<td>/dev/fd[0-1]</td>
</tr>
<tr>
<td>打印机</td>
<td>25针：/dev/lp[0-2]<br />USB：/dev/usb/ lp[0-15]</td>
</tr>
<tr>
<td>鼠标</td>
<td>USB:/dev/usb/mouse[0-15]<br />PS2: /dev/psaux</td>
</tr>
<tr>
<td>CD-ROM/DVD</td>
<td>/dev/cdrom</td>
</tr>
<tr>
<td>当前鼠标</td>
<td>/dev/mouse</td>
</tr>
<tr>
<td>磁带机</td>
<td>IDE:/dev/ht0<br />SCSI:/dev/st0</td>
</tr>
</tbody></table>
<h5 id="硬盘设备命名规则"><a href="#硬盘设备命名规则" class="headerlink" title="硬盘设备命名规则"></a>硬盘设备命名规则</h5><table>
<thead>
<tr>
<th><strong>设备文件</strong></th>
<th><strong>对应设备</strong></th>
</tr>
</thead>
<tbody><tr>
<td>sda</td>
<td>a 表示第一个出现的硬盘，代表一个硬盘</td>
</tr>
<tr>
<td>sda1</td>
<td>第一个硬盘中的第一个分区</td>
</tr>
<tr>
<td>sda2</td>
<td>第一个硬盘中的第二个分区</td>
</tr>
<tr>
<td>sda3</td>
<td>第一个硬盘中的第三分区</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><strong>设备文件</strong></th>
<th><strong>对应设备</strong></th>
</tr>
</thead>
<tbody><tr>
<td>sdb</td>
<td>b 表示第二个出现的硬盘，代表一个硬盘</td>
</tr>
<tr>
<td>sdb1</td>
<td>第二个硬盘中的第一个分区</td>
</tr>
<tr>
<td>sdb2</td>
<td>第二个硬盘中的第二个分区</td>
</tr>
</tbody></table>
<hr>
<h3 id="文件系统-ext-gt-ext4版本发展"><a href="#文件系统-ext-gt-ext4版本发展" class="headerlink" title="文件系统    ext-&gt;ext4版本发展"></a>文件系统    ext-&gt;ext4版本发展</h3><table>
<thead>
<tr>
<th>ext</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>ext2</td>
<td>1. ext2升级版，1993年发布<br />2. red hat linux7.2以前默认文件系统ext2<br />3. 最大支持16TB分区，2TB文件</td>
</tr>
<tr>
<td>ext3</td>
<td>1. 与ext2最大区别：带日志功能，系统突然停止时可提高文件系统可靠性<br />2. 最大支持16TB分区，2TB文件</td>
</tr>
<tr>
<td>ext4</td>
<td>1. 在性能，伸缩性，可靠性方面有重大改进<br />2. 向下兼容ext3，无限数量子目录，extents连续数据块，多块/延迟/持久预分配，快速fsck，日志校验，无日志模式，在线碎片整理，inode增强，默认启用barrier…<br />3. 最大1EB文件系统分区，16TB文件（1EB=1024PB=1024*1024TB）<br />4.默认文件系统entos6.3</td>
</tr>
</tbody></table>
<h2 id="文件系统常用命令"><a href="#文件系统常用命令" class="headerlink" title="文件系统常用命令"></a>文件系统常用命令</h2><h4 id="文件系统查看-df"><a href="#文件系统查看-df" class="headerlink" title="文件系统查看 df"></a>文件系统查看 df</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df [选项]	[挂载点]</span><br><span class="line">	-a	显示所有文件系统信息，包括特殊文件系统（eg./proc, /sysfs等)</span><br><span class="line">	-h	人性化显示，KB，MB，GB</span><br><span class="line">	-T	显示文件系统类型</span><br><span class="line">	-m	以MB为单位显示容量</span><br><span class="line">	-k	  KB(默认)</span><br></pre></td></tr></table></figure>

<p>-h修改 文件大小单位</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012141658.png" alt="image-20201012141658507" style="zoom:50%;" />

<p>-a参数可查看所有文件系统，包括虚拟文件系统</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012141850.png" alt="image-20201012141850106" style="zoom:50%;" />



<h4 id="统计目录或文件大小du"><a href="#统计目录或文件大小du" class="headerlink" title="统计目录或文件大小du"></a>统计目录或文件大小du</h4><p>ll -h 目录命令统计一级文件名+子文件名占用空间大小，不统计数据，与du有所区别</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">du [选项]	[目录/文件名]</span><br><span class="line">		-a	显示每个子文件磁盘占用量，默认只统计子目录</span><br><span class="line">		-h	人性化显示占用量</span><br><span class="line">		-s	统计总占用量，不列出子文件/目录占用量</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012141935.png" alt="image-20201012141935934" style="zoom: 60%;" />

<p>du -sh在统计前需扫描目录，属于高负载命令（大规模数据读写/扫描）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012142314.png" alt="image-20201012142314204" style="zoom:67%;" />

<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p><strong>Q:df与du检测出的<code>/</code>占用空间大小不同？</strong></p>
<p>du检测/得到的大小是9.1G，df检测得到的大小是8.1G</p>
<p><strong>S:du与df区别：</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/f-ck-need-u/p/8659301.html">du与df</a></p>
<ul>
<li><p>df：面向文件系统，考虑文件占用的空间+系统/进程/命令/程序占用空间（eg.文件删除但进程调用没有释放空间），多用于统计剩余空间。读取每个分区的superblock获取空闲块，已使用数据块，计算空闲空间和已使用空间</p>
</li>
<li><p>du：面向文件，只计算文件/目录占用空间，多用于统计文件占用大小(包括挂载文件。根据命令stat统计文件占用和。</p>
<p>一般来说，df要比du大</p>
</li>
</ul>
<h4 id="文件系统修复命令fsck"><a href="#文件系统修复命令fsck" class="headerlink" title="文件系统修复命令fsck"></a>文件系统修复命令fsck</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fsck [选项]	分区设备文件名</span><br><span class="line">		-a:不同显示用户提示，自动修复文件系统</span><br><span class="line">		-y:自动修复。与-a作用一致，只不过某些文件系统支支持-y</span><br></pre></td></tr></table></figure>

<p>重启自动进行,用户一般不设置</p>
<h4 id="检测磁盘状态命令dumpe2fs"><a href="#检测磁盘状态命令dumpe2fs" class="headerlink" title="检测磁盘状态命令dumpe2fs"></a>检测磁盘状态命令dumpe2fs</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpe2fs	分区设备文件名</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012173649.png" alt="image-20201012173649023" style="zoom:50%;" />




<h4 id="挂载命令，光盘-u盘mount"><a href="#挂载命令，光盘-u盘mount" class="headerlink" title="挂载命令，光盘/u盘mount"></a>挂载命令，光盘/u盘mount</h4><h5 id="查询与自动挂载"><a href="#查询与自动挂载" class="headerlink" title="查询与自动挂载"></a>查询与自动挂载</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount [-l]		查询系统中已挂载设备，-l显示卷标名</span><br><span class="line">			-a			依据配置文件/etc/fstab内容自动挂载</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012174019.png" alt="image-20201012174019488" style="zoom: 50%;" />



<h5 id="挂载命令"><a href="#挂载命令" class="headerlink" title="挂载命令"></a>挂载命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mount [-t 文件系统] [-L 卷标名]	\ [-o 特殊选项]  设备文件名 挂载点</span><br><span class="line">			-t 文件系统		加入文件系统类型指定挂载类型，eg.ext3,ext4,ios9660</span><br><span class="line">			-L 卷标名		挂载指定卷标的分区，而非安装设备文件名挂载</span><br><span class="line">			-o 特殊选项		指定挂载的额外选项，多个选项，分割</span><br><span class="line">			eg: -o remount,rw 挂载点</span><br><span class="line">					-o exec 挂载点</span><br><span class="line">			</span><br></pre></td></tr></table></figure>

<ul>
<li><p>[]中内容非必须</p>
</li>
<li><p>特殊选项：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093735.png" alt="image-20201001161444801" style="zoom: 50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012174855.png" alt="image-20201012174855356" style="zoom:50%;" />





</li>
</ul>
<h5 id="挂载光盘"><a href="#挂载光盘" class="headerlink" title="挂载光盘"></a>挂载光盘</h5><p>光盘，u盘，移动硬盘不会自动挂载，因为不能保证每次开机都连接到设备。需要手动挂载。但现在较新的linux系统中光驱设备可自动挂载（在/media/cdrom下）</p>
<p><code>mount</code>查看可见挂载信息,通过挂载点可查看光盘内容</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012174956.png" alt="image-20201012174956453" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012175127.png" alt="image-20201012175127416" style="zoom: 70%;" />

<p>若没有自动挂载可在Workstation-虚拟机-设置中勾选已连接（不选相当于未上电），选择光盘文件保存</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093734.png" alt="image-20201001145530189" style="zoom: 50%;" />



<p>终端中新建挂载点挂载。（iso9660 是光盘的默认文件系统。由于linux系统可以自动识别光盘的文件系统，故“-t iso9660”也可以省略不写）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/cdrom		#建立挂载点</span><br><span class="line">mount -t iso9660 /dev/cdrom /mnt/cdrom/		#挂载光盘</span><br><span class="line">mount /dev/sr0 /mnt/cdrom		#设备文件名/dev/sr0与/dev/cdrom(软链接)等同</span><br></pre></td></tr></table></figure>

<h5 id="卸载命令"><a href="#卸载命令" class="headerlink" title="卸载命令"></a>卸载命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount 设备文件名/挂载点	(一旦挂载，二者建立连接，断开哪一边效果等同)</span><br><span class="line">umount /mnt/cdrom</span><br></pre></td></tr></table></figure>

<h5 id="挂载u盘"><a href="#挂载u盘" class="headerlink" title="挂载u盘"></a>挂载u盘</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l	#查看设备文件名</span><br><span class="line">mount -t vfat(u盘文件系统类型可查看属性) /dev/sdb1 /mnt/usb</span><br></pre></td></tr></table></figure>

<ul>
<li>挂载u盘时不能用远程工具，需用linux虚拟机，因为本机和虚拟机识别u盘存在竞争关系</li>
<li>u盘文件类型：linux默认不支持NTFS文件系统。ntfs和exfat需安装支持。</li>
</ul>
<p><strong>支持NTF文件系统</strong></p>
<p>linux系统自动识别加载驱动，常见驱动都包含在内核中 ，但默认不支持NTFS</p>
<p><strong>解决方法：</strong></p>
<ol>
<li><p>重新编译内核，手动加载驱动（比较麻烦，推荐2）</p>
</li>
<li><p>插件ntfs-3g</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget  https://tuxera.com/opensource/ntfs-3g_ntfsprogs-2017.3.23.tgz	#官方安装包下载 </span><br><span class="line">tar -zxvf ntfs-3g_ntfsprogs-2017.3.23.tgz		#解压缩</span><br><span class="line">cd ntfs-3g_ntfsprogs-2017.3.23			#编译安装</span><br><span class="line">./configure</span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>如报错需要gcc支持，安装gcc即可<code>yum install gcc</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ntfs-3g 分区设备文件名 挂载点</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="fdisk分区"><a href="#fdisk分区" class="headerlink" title="fdisk分区"></a>fdisk分区</h2><h3 id="分区过程"><a href="#分区过程" class="headerlink" title="分区过程"></a>分区过程</h3><h4 id="添加新硬盘"><a href="#添加新硬盘" class="headerlink" title="添加新硬盘"></a>添加新硬盘</h4><p>虚拟机断电，在设置中添加即可（此处添加硬盘类型为SCSI）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012175844.png" alt="image-20201012175844062" style="zoom: 40%;" />

<h4 id="查看分区情况"><a href="#查看分区情况" class="headerlink" title="查看分区情况"></a>查看分区情况</h4><p><code>fdisk -l</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012180237.png" alt="image-20201012180236963" style="zoom: 50%;" />



<h4 id="分区-1"><a href="#分区-1" class="headerlink" title="分区"></a>分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk 待分区设备文件名</span><br></pre></td></tr></table></figure>

<p>fdisk交互指令说明：</p>
<p>基础操作：n,d,p,l,w,q</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181812.png" alt="image-20201012181224614" style="zoom:40%;" />

<ol>
<li><p>配置新硬盘/dev/sdb</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181813.png" alt="image-20201012181505910" style="zoom:50%;" />
</li>
<li><p>输入l显示已知文件系统类型</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181814.png" alt="image-20201012181619024" style="zoom: 50%;" />

<p>输入p查看分区列表，目前为空</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181815.png" alt="image-20201012181714589" style="zoom: 50%;" />
</li>
<li><p>新建分区n</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181923.png" alt="image-20201012181923221" style="zoom:50%;" />

<p>选择主分区p</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012181958.png" alt="image-20201012181958406" style="zoom:67%;" />

<p>起始扇区默认，结束扇区 +2G</p>
<p>输入p查看分区列表</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012182104.png" alt="image-20201012182104735" style="zoom: 50%;" />
</li>
<li><p>新建扩展分区,输入n–&gt;e。分区序号最好按顺序，起始扇区默认从上个分区末尾进行，结束扇区默认，即把剩余空间全部分给扩展分区。</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012182404.png" alt="image-20201012182404377"></p>
</li>
<li><p>扩展分区建好后就可以开始分逻辑分区了。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012182730.png" alt="image-20201012182730781" style="zoom:50%;" />
</li>
<li><p>w保存退出</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012182819.png" alt="image-20201012182819475" style="zoom:67%;" />
</li>
<li><p>生效需重启系统或者重新读取分区表信息(省去重启过程)</p>
<p><code>partprobe</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012182936.png" alt="image-20201012182936239"></p>
</li>
<li><p>格式化mkfs</p>
<p>分区将“大柜子”分割成“小柜子”，格式化在“小柜子”中打入“隔断”</p>
<p><code>mkfs -t ext4 /dev/sdb1</code>格式化分区sdb1</p>
<p><code>mkfs -t ext4 /dev/sdb5</code>格式化分区sdb5</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012183052.png" alt="image-20201012183052512"></p>
</li>
</ol>
<h4 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h4><p>目前分区情况</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012183216.png" alt="image-20201012183216920" style="zoom:50%;" />

<p>创建目录disk1和disk5分别用来挂载sdb1和sdb5。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012184904.png" alt="image-20201012184904933" style="zoom:50%;" />

<p>额，这里挂载逻辑分区报错是因为忘记格式化那个分区了，格式化后再次挂载即可。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185100.png" alt="image-20201012185100156" style="zoom: 50%;" />

<p> fdisk只能看到分区是否被正常分配，不能看到挂载。<strong>mount或df可查看挂载情况</strong></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185211.png" alt="image-20201012185211338" style="zoom:50%;" />

<p>mount查看</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185422.png" alt="image-20201012185422254" style="zoom:50%;" />

<p> df</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185312.png" alt="image-20201012185312518"></p>
<p>问题：手动挂载重启分区消失需要重新挂载，永久需要写入文件/etc/fstab</p>
<h3 id="自动挂载与fstab文件修复"><a href="#自动挂载与fstab文件修复" class="headerlink" title="自动挂载与fstab文件修复"></a>自动挂载与fstab文件修复</h3><p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185528.png" alt="image-20201012185528602"></p>
<p>格式：</p>
<p>分区设备文件名/UUID(硬盘通用唯一识别码)    挂载点    文件系统名称    挂载参数/特殊权限    指定分区dump备份[0不1每天备份2不定期备份]        是否被fsck检测[0不检测其他num检测优先级]</p>
<h4 id="UUID查看"><a href="#UUID查看" class="headerlink" title="UUID查看"></a>UUID查看</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185704.png" alt="image-20201012185704793" style="zoom:67%;" />

<p>太长可配合grep使用</p>
<h4 id="自动备份-挂载点下lost-found"><a href="#自动备份-挂载点下lost-found" class="headerlink" title="自动备份       挂载点下lost+found"></a>自动备份       挂载点下lost+found</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012185831.png" alt="image-20201012185831022" style="zoom: 50%;" />

<ul>
<li>自动挂载修改/etc/fstab文件eg:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdb1       /disk1  ext4    defaults        1 2</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012190032.png" alt="image-20201012190032370" style="zoom:67%;" />



<ul>
<li>文件写错或删除/disk 会使系统崩溃</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount -a	#依据配置文件/etc/fstab内容自动挂载分区，</span><br><span class="line">					#可在修改文件后执行进行检验是否成功修改</span><br></pre></td></tr></table></figure>

<h4 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h4><p>情景：修改文件fstab后重启后报错，输入root密码</p>
<p>修复：vi修改fstab文件</p>
<p>如文件只读，不可保存修改则重新挂载根目录/,加入读写权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,rw /</span><br></pre></td></tr></table></figure>

<p><strong>局限性</strong>：只能修复文件报错；若根分区错误，无法修改</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-6-shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-6-shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">linux基础_6.shell编程基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:22:17" itemprop="dateCreated datePublished" datetime="2020-10-11T09:22:17+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:22" itemprop="dateModified" datetime="2020-10-13T12:58:22+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="shell概述"><a href="#shell概述" class="headerlink" title="shell概述"></a>shell概述</h2><h3 id="什么是shell"><a href="#什么是shell" class="headerlink" title="什么是shell"></a>什么是shell</h3><ul>
<li><p>命令解释器，向用户提供向内核发送请求的界面（双向翻译）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093928.png" alt="image-20201001183116659" style="zoom:50%;" />
</li>
<li><p>编程语言，解释执行的脚本语言，可直接调用linux系统命令</p>
</li>
</ul>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ol>
<li><p>bourne shell(1970,unix)，主文件名sh</p>
<p>包括sh, ksh, Bash, psh, zsh;</p>
</li>
<li><p>C shell，主要用于BSD版unix，语法与C类似<br>包括csh, tcsh</p>
<p>两种语法（B shell&amp;C shell）不兼容。linux主流shell-Bash，与sh兼容。</p>
</li>
</ol>
<h3 id="linux支持的shell"><a href="#linux支持的shell" class="headerlink" title="linux支持的shell"></a>linux支持的shell</h3><p> <code>cat  /etc/shells</code>可查看该文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012192028.png" alt="image-20201012191714842" style="zoom: 67%;" />

<p><strong>bash切换</strong>输入shell名即可，退出exit</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012192218.png" alt="image-20201012192218608" style="zoom:50%;" />



<ul>
<li><p>/etc/passwd 最后一个字段为用户登录后权限</p>
<p> ​    root-/bin/bash, </p>
<p> ​    命令（伪用户）-/sbin/nologin, </p>
<p> ​    shutdown-/sbin/shutdown    表示只能执行该命令（halt同）</p>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012192538.png" alt="image-20201012192538519" style="zoom:50%;" />





<h2 id="shell脚本执行方式"><a href="#shell脚本执行方式" class="headerlink" title="shell脚本执行方式"></a>shell脚本执行方式</h2><h3 id="echo输出语句"><a href="#echo输出语句" class="headerlink" title="echo输出语句"></a>echo输出语句</h3><p><code>!</code>在shell中有特殊作用，不能在<code>&quot;</code>中输出，输出需换为<code>&#39;</code>, 但在shell脚本中可以使用。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012192808.png" alt="image-20201012192808428" style="zoom: 67%;" />

<h4 id="一些实例"><a href="#一些实例" class="headerlink" title="一些实例"></a>一些实例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">echo -e 输出内容			#-e参数支持转义字符</span><br><span class="line"></span><br><span class="line">转义字符:</span><br><span class="line">\\:输出\本身</span><br><span class="line">\a:输出警告音	\b：退格键/向左删除	\c：取消输出行末换行符	\e：ESCAPE键	</span><br><span class="line">\f：换页符	   \n：换行					\r：回车					   	</span><br><span class="line">\t：水平制表符，tab	\v：垂直制表符</span><br><span class="line">\0：八进制--	 \x:shi十六进制输出ASCII码</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012193234.png" alt="image-20201012193234062" style="zoom:67%;" />

<p>使用<code>\</code>可实现多行输入命令</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012193336.png" alt="image-20201012193336557" style="zoom:67%;" />

<p>“\x61\t\x62\t\x63\n\x64\t\x65\t\x66”是字母的16进制ASCII表示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;\e[1;colornum 内容 \e[0m&quot;		固定表达：颜色输出</span><br><span class="line"></span><br><span class="line">colornum</span><br><span class="line">30m黑色，31m红色，32m绿色，33m黄色，</span><br><span class="line">34m蓝色，35m洋红，36m青色，37m白色</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012193520.png" alt="image-20201012193520414" style="zoom:67%;" />



<h3 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h3><h4 id="编写脚本hello-sh"><a href="#编写脚本hello-sh" class="headerlink" title="编写脚本hello.sh"></a>编写脚本hello.sh</h4><p>实际上linux中文件不需要后缀，这里添加后缀只是为了管理者方便辨认</p>
<p>使用<code>cat -A hello.sh</code>查看下脚本内容(-A指包含隐藏字符),这是一个简单的输出语句</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012193931.png" alt="image-20201012193931886" style="zoom:50%;" />

<ul>
<li><p><code>#!/bin/bash</code>标称以下语句时sh脚本,本身可省略。但如果在脚本1中嵌入其他脚本2，且脚本2没有声称#!/bin/Bash,则会出现报错</p>
</li>
<li><p>$为linux中的回车符</p>
</li>
</ul>
<h4 id="执行脚本-1"><a href="#执行脚本-1" class="headerlink" title="执行脚本"></a>执行脚本</h4><h5 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h5><p>赋予执行权限<code>chmod 755 hello.sh</code></p>
<p>然后使用<code>./脚本路径</code>执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012194315.png" alt="image-20201012194315488"></p>
<h5 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h5><p> 通过bash调用执行，无需赋权755<br> <code>bash hello.sh </code>    </p>
<ul>
<li><p>若出现错误 “bash: ./hello.sh: /bin/Bash: bad interpreter: No such file or directory.” 可能是文件格式错误，</p>
<p>   可用vim打开输入:set ff查看文件格式，如果为dos，可使用:set ff=unix修改，然后使用:wq保存退出</p>
<p>   或者使用<code>#dos2unix 文件名</code>转换(需要安装支持)</p>
</li>
</ul>
<h2 id="bash的基本功能"><a href="#bash的基本功能" class="headerlink" title="bash的基本功能"></a>bash的基本功能</h2><h3 id="历史命令与补全"><a href="#历史命令与补全" class="headerlink" title="历史命令与补全"></a>历史命令与补全</h3><h4 id="history"><a href="#history" class="headerlink" title="history"></a>history</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">history [选项]	[历史命令保存文件]</span><br><span class="line">				-c 清空历史命令</span><br><span class="line">				-w 把缓存中的历史命令即时写入历史命令保存文件~/.bash_history，默认退出登录后才会写入</span><br><span class="line">				</span><br></pre></td></tr></table></figure>

<p>输入<code>history</code>可查询历史命令</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012195537.png" alt="image-20201012195537072" style="zoom:50%;" />

<p><code>history -c</code>#清空缓存的历史命令，慎用。不建议清空历史命令。原因：</p>
<ol>
<li><p>可回溯；</p>
</li>
<li><p>黑客习惯于清空隐藏，有助于判断攻击情况；</p>
</li>
<li><p>特殊情况下例如为mysql设置密码后记录会存入文件存在安全隐患</p>
</li>
</ol>
<p>历史命令记录在/root/.bash_history下</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012195810.png" alt="image-20201012195810363" style="zoom:67%;" />

<p>命令还停留在第997条，可知新的历史命令未写入文件，关机或重启后才会更新。可使用<code> history -w</code>强制写入。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012200052.png" alt="image-20201012200052704" style="zoom:50%;" />



<ul>
<li><p>历史命令默认保存1000条，可在环境变量配置文件中修改/etc/profile，修改后生效需重新登录</p>
<p>若超过1000条会删除第一条，保存1001条</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012200313.png" alt="image-20201012200313914"></p>
</li>
</ul>
<h4 id="历史命令调用tips"><a href="#历史命令调用tips" class="headerlink" title="历史命令调用tips"></a>历史命令调用tips</h4><ul>
<li><p>上下箭头调用之前的命令</p>
</li>
<li><p>!n    重复执行第n条（history查询命令前有序号）</p>
</li>
<li><p>!!      重复执行上一条命令</p>
</li>
<li><p>!字串  重复执行最后一条以该字符串开头的命令</p>
</li>
<li><p>命令与文件补全tab</p>
<p>命令/文件/目录     Tab补全，没反应说明有多个该字符串开头的文件/命令/目录，再次敲击可查看</p>
</li>
</ul>
<h3 id="别名alias与bash快捷键"><a href="#别名alias与bash快捷键" class="headerlink" title="别名alias与bash快捷键"></a>别名alias与bash快捷键</h3><h4 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h4><p>除非确定，否则定义的别名不应与现有命令重合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias 别名=&#x27;原命令&#x27;</span><br><span class="line">eg.alias vi=&#x27;vim&#x27;</span><br></pre></td></tr></table></figure>

<p>查看现有命令别名</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012205138.png" alt="image-20201012205137967" style="zoom:67%;" />



<p><strong>命令执行优先级：</strong></p>
<p>绝对路径/相对路径执行&gt;执行别名&gt;执行bash内部命令&gt;按照环境变量$PATH定义的目录查找顺序找到的第一个命令</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012205323.png" alt="image-20201012205323770" style="zoom:50%;" />

<ul>
<li>命令执行需用绝对路径，平时使用不用绝对路径是因为已被放入PATH中</li>
<li>永久生效-写入配置文件/root/.bashrc</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012205414.png" alt="image-20201012205414406" style="zoom:60%;" />



<p>删除别名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unalias 别名</span><br></pre></td></tr></table></figure>



<h4 id="bash常用快捷键"><a href="#bash常用快捷键" class="headerlink" title="bash常用快捷键"></a>bash常用快捷键</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012205612.png" alt="image-20201012205612565" style="zoom:50%;" />



<p>按ctrl+R后输入ca,搜索到之前使用过含ca的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(reverse-i-search)`ca&#x27;: cat /etc/profile|grep HISTS</span><br></pre></td></tr></table></figure>



<h3 id="输入输出重定向"><a href="#输入输出重定向" class="headerlink" title="输入输出重定向"></a>输入输出重定向</h3><p>标准输入输出</p>
<table>
<thead>
<tr>
<th>设备</th>
<th>设备文件名</th>
<th>文件描述符</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>键盘</td>
<td>/dev/stdin</td>
<td>0</td>
<td>标准输入</td>
</tr>
<tr>
<td>显示器</td>
<td>/dev/stdout</td>
<td>1</td>
<td>标准输出</td>
</tr>
<tr>
<td>显示器</td>
<td>/dev/sdterr</td>
<td>2</td>
<td>标准错误输出</td>
</tr>
</tbody></table>
<h4 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093929.png" alt="image-20201002213911045" style="zoom:67%;" />

<h5 id="标准输出重定向"><a href="#标准输出重定向" class="headerlink" title="标准输出重定向"></a>标准输出重定向</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">命令 &gt; 文件		#以覆盖方式将命令输出到文件/指定设备</span><br><span class="line">命令 &gt;&gt; 文件	#以追加方式，将命令输出到指定文件/设备</span><br></pre></td></tr></table></figure>

<p>重定向符后的空格可省略，前不可省。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012205923.png" alt="image-20201012205923435" style="zoom: 50%;" />

<p>再次使用&gt;重定向到文件时，原来的内容会被覆盖</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012210035.png" alt="image-20201012210035266" style="zoom: 67%;" />

<p>使用&gt;&gt;可追加至文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012210137.png" alt="image-20201012210137914" style="zoom: 67%;" />



<h5 id="标准错误输出重定向"><a href="#标准错误输出重定向" class="headerlink" title="标准错误输出重定向"></a>标准<strong>错误</strong>输出重定向</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">错误命令 2&gt; 文件		#以覆盖方式将命令的错误信息输出到文件/指定设备</span><br><span class="line">错误命令 2&gt;&gt; 文件	#以追加方式，将命令的错误信息输出到指定文件/设备</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012210409.png" alt="image-20201012210409854" style="zoom:67%;" />



<h5 id="同时保存正确和错误输出结果"><a href="#同时保存正确和错误输出结果" class="headerlink" title="同时保存正确和错误输出结果"></a><strong>同时保存</strong>正确和错误输出结果</h5><p>省去人为查看命令是否正确切换重定向命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令 &gt; 文件 2&gt;&amp;1		#以覆盖方式将正确和错误输出保存到一个文件中</span><br><span class="line">命令 &gt;&gt; 文件 2&gt;&amp;1		#追加方式.....</span><br><span class="line">命令 &amp;&gt; 文件				#作用同上,覆盖</span><br><span class="line">命令 &amp;&gt;&gt; 文件				#作用同上，追加</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012210631.png" alt="image-20201012210631911" style="zoom:60%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令 &gt;&gt; 文件1 2&gt;&gt;文件2        #追加方式，正确输出-&gt;文件1，错误输出-&gt;文件2</span><br><span class="line"></span><br><span class="line">ls &gt;&gt; right 2&gt;&gt;fault			  #分类输出结果信息</span><br></pre></td></tr></table></figure>



<h5 id="重定向特殊应用-dev-null-类似垃圾箱"><a href="#重定向特殊应用-dev-null-类似垃圾箱" class="headerlink" title="重定向特殊应用 /dev/null(类似垃圾箱)"></a>重定向特殊应用 /dev/null(类似垃圾箱)</h5><p> 多用于处理shell脚本中的无意义输出, 丢弃一切写入其中的数据（但报告写入操作成功），读取它则会立即得到一个EOF。<a target="_blank" rel="noopener" href="https://blog.csdn.net/zqtsx/article/details/41894223">详解</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls &amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>

<ul>
<li>错误输出2和&gt;之间不能用空格</li>
</ul>
<h4 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093930.png" alt="image-20201002220921683" style="zoom:67%;" />



<h5 id="统计命令wc，Ctrl-D退出"><a href="#统计命令wc，Ctrl-D退出" class="headerlink" title="统计命令wc，Ctrl+D退出"></a>统计命令wc，Ctrl+D退出</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012211055.png" alt="image-20201012211055858" style="zoom:67%;" />

<p>结果：6行，6个词，21个字节(包括换行符)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wc &lt;&lt; 字符ch</span><br><span class="line">&lt;输入内容</span><br><span class="line">...</span><br><span class="line">&lt;字符ch</span><br><span class="line">统计ch中间的内容</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012211728.png" alt="image-20201012211728869" style="zoom:60%;" />



<h5 id="使用输入重定向统计文件"><a href="#使用输入重定向统计文件" class="headerlink" title="使用输入重定向统计文件"></a>使用输入重定向统计文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wc [选项] [文件名]</span><br><span class="line">		-c   统计字节数</span><br><span class="line">		-w		统计单词数</span><br><span class="line">		-l		统计行数</span><br></pre></td></tr></table></figure>


<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012211359.png" alt="image-20201012211359902" style="zoom:50%;" />




<h3 id="多命令顺序执行与管道符"><a href="#多命令顺序执行与管道符" class="headerlink" title="多命令顺序执行与管道符"></a>多命令顺序执行与管道符</h3><h4 id="多命令顺序执行"><a href="#多命令顺序执行" class="headerlink" title="多命令顺序执行"></a>多命令顺序执行</h4><h5 id="命令拼接"><a href="#命令拼接" class="headerlink" title=";命令拼接"></a>;命令拼接</h5><p>命令1<code>;</code>命令2<code>;</code>命令3…….<code>;</code>命令n</p>
<p>n个命令顺序执行，之间没有逻辑关系</p>
<p>eg. <code> ls;date;cd /user;pwd</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212142.png" alt="image-20201012212142389" style="zoom:67%;" />



<h5 id="amp-amp-逻辑与"><a href="#amp-amp-逻辑与" class="headerlink" title="&amp;&amp;逻辑与"></a>&amp;&amp;逻辑与</h5><p>命令1<code>&amp;&amp;</code>命令2</p>
<p>命令1正确执行，命令2才会执行</p>
<p>eg. <code>ls hello.sh &amp;&amp; echo yes</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212228.png" alt="image-20201012212228161" style="zoom:67%;" />



<h5 id="逻辑或"><a href="#逻辑或" class="headerlink" title="||逻辑或"></a>||逻辑或</h5><p>命令1<code>||</code>命令2</p>
<p>“短路执行”：命令1正确，则命令2不执行；命令1错误，命令2 执行</p>
<p>eg.<code> ls /hhh || echo no</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212314.png" alt="image-20201012212314784" style="zoom:67%;" />

<p>eg2.<code>ls /hhh &amp;&amp; echo yes|| echo no</code>                #命令成功输出yes,失败no</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212422.png" alt="image-20201012212421968"></p>
<h5 id="计算命令执行时间"><a href="#计算命令执行时间" class="headerlink" title="计算命令执行时间"></a>计算命令执行时间</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> date;命令;date</span></span><br></pre></td></tr></table></figure>

<h5 id="“升级版”拷贝命令dd"><a href="#“升级版”拷贝命令dd" class="headerlink" title="“升级版”拷贝命令dd:"></a>“升级版”拷贝命令dd:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dd if=源(输入)文件/设备 of=目标(输出)文件/设备 bs=字节数 count=个数</span><br><span class="line">选项：</span><br><span class="line">bs=字节数			指定单次输入/输出多少字节，将其看做一个数据块</span><br><span class="line">count=个数		 指定输入/输出多少数据块</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>dd</strong>可拷贝文件，包括特殊文件（分区，硬盘文件系统），可视为硬盘数据拷贝命令；<strong>cp</strong>仅可拷贝狭义的文件</p>
</li>
<li><p>/dev/zero是一个特殊的文件，读取它时会提供无限的空字符(NULL, ASCII NUL, 0x00)。<a target="_blank" rel="noopener" href="https://blog.csdn.net/zqtsx/article/details/41894223">详解</a></p>
<p>典型用法1：用它提供的字符流来覆盖信息；</p>
<p>常见用法2：产生一个特定大小的空白文件。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=/dev/sdb bs=4M 来重新给整个U盘清零</span><br><span class="line">date;dd if=/dev/zero of=/root/testfile bs=1k count=100000;date</span><br><span class="line"><span class="meta">#</span><span class="bash">计算产生100000k空白文件所需的时间</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212740.png" alt="image-20201012212740222"></p>
<h4 id="管道符"><a href="#管道符" class="headerlink" title="管道符"></a>管道符</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令1 | 命令2			#将命令1的输出作为命令2的输入</span><br></pre></td></tr></table></figure>

<p>注意：命令1必须有正确输出，命令2才能执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ll -a /etc/ |more			<span class="comment">#翻页查看命令执行结果</span></span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012212934.png" alt="image-20201012212934659" style="zoom: 50%;" />

<p>将使用more查看ll -a查询的结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> netstat -an |grep <span class="string">&quot;ESTA&quot;</span></span></span><br><span class="line">tcp        0     96 192.168.52.128:22       192.168.52.1:58323      ESTABLISHED</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012213111.png" alt="image-20201012213100918" style="zoom:67%;" />

<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/peida/archive/2013/03/08/2949194.html">netstat</a></p>
</li>
<li><p>grep—类似过滤器</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep [选项]	“搜索内容”</span><br><span class="line">			-i  忽略大小写</span><br><span class="line">			-n	输出行号</span><br><span class="line">			-v	反向查找即搜索不符合条件的内容</span><br><span class="line">			--color=auto	搜索出的关键字颜色显示</span><br></pre></td></tr></table></figure>



<h3 id="通配符与其他特殊符号"><a href="#通配符与其他特殊符号" class="headerlink" title="通配符与其他特殊符号"></a>通配符与其他特殊符号</h3><h4 id="通配符（完全匹配）"><a href="#通配符（完全匹配）" class="headerlink" title="通配符（完全匹配）"></a>通配符（完全匹配）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?		匹配一个任意字符</span><br><span class="line">*		匹配任意多个字符</span><br><span class="line">[]	匹配[]内任意一个字符,eg:[abc]hhh，可匹配ahhh,bhhh,chhh</span><br><span class="line">[-]	匹配[]内任意一个字符，-表范围[0-9]匹配数字0到9，[a-z][A-Z]分别一个匹配小写字母和大写字母</span><br><span class="line">[^]	逻辑非，eg:[^0-9]匹配一个非数字字符</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012213424.png" alt="image-20201012213424424" style="zoom:50%;" />

<ul>
<li>主要区分“一个”？和“多个”*字符</li>
</ul>
<h4 id="其他Bash中的特殊符号"><a href="#其他Bash中的特殊符号" class="headerlink" title="其他Bash中的特殊符号"></a>其他Bash中的特殊符号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x27;				#单引号，单引号内所有特殊字符(eg.$ `反引号`)都没有特殊含义</span><br><span class="line">&quot;				#双引号，除$,``,\外其余特殊符号没有特殊含义直接显示。</span><br><span class="line">				# 			$-调用变量值，``反引号-引用命令，\-转义</span><br><span class="line">``			#反引号，`系统命令`，在bash中先执行，作用与$(命令)一致，推荐后者，``容易看错</span><br><span class="line"><span class="meta">$</span><span class="bash">()			<span class="comment">#引用系统命令，区别于``的是，此处调用最后执行，``调用时执行</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">				<span class="comment">#表注释</span></span></span><br><span class="line">\				#转义符，eg:\$,输出$符而不是变量引用</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&#39;</code>和<code>&quot;</code>区别：<code>&#39;</code>输出纯字串，不存在特殊字符特殊作用或命令调用</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012213911.png" alt="image-20201012213911455" style="zoom:67%;" />



<ul>
<li><p>``` <code>和</code>$()`的区别</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012214053.png" alt="image-20201012214053115" style="zoom:67%;" />

<p>虽然执行结果相同，但``先执行命令，将结果赋给abc变量；$()输出时执行命令调用</p>
</li>
</ul>
<h2 id="bash的变量"><a href="#bash的变量" class="headerlink" title="bash的变量"></a>bash的变量</h2><h3 id="用户自定义变量"><a href="#用户自定义变量" class="headerlink" title="用户自定义变量"></a>用户自定义变量</h3><h4 id="什么是变量"><a href="#什么是变量" class="headerlink" title="什么是变量"></a>什么是变量</h4><ul>
<li>变量时计算机内存单元，其中存放的值可以改变。</li>
</ul>
<ul>
<li>每个变量有一个名字，可以用于引用。</li>
</ul>
<ul>
<li>变量可用于保存暂时信息。</li>
</ul>
<h4 id="设置规则"><a href="#设置规则" class="headerlink" title="设置规则"></a>设置规则</h4><ul>
<li><p>变量名可由<strong>字母，数字，下划线</strong>组成，但只能以字母或下划线开头。eg：2numer（X）</p>
</li>
<li><p>bash中 变量默认<strong>字符串类型</strong>，如需运算，需要指定为数值型</p>
</li>
<li><p>变量=值，=左右不能有空格。变量值如果有空格，需用<code>&#39;</code>或<code>&quot;</code>包含为一个整体。</p>
<p>eg：abc12=”hello world”</p>
</li>
<li><p>变量值可叠加，但需要”$变量名”或${变量名}包含被操作变量。</p>
<p>eg：PATH=”$PATH”:/root  或 PATH＝${PATH}:/root相当于在PATG后追加:/root</p>
</li>
<li><p>如将命令结果作为变量值赋予变量需用``` <code>， 或</code>$()`包含命令</p>
<p>eg: aa=`ls`  或 aa=$(ls)</p>
</li>
<li><p>环境变量名建议大写，便于区分</p>
</li>
</ul>
<h4 id="变量分类"><a href="#变量分类" class="headerlink" title="变量分类"></a>变量分类</h4><table>
<thead>
<tr>
<th>变量</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>用户自定义变量</td>
<td>自定义</td>
<td>变量名可修改，变量作用不定</td>
</tr>
<tr>
<td>环境变量</td>
<td>保存和系统操作环境相关数据</td>
<td>变量名不能自定义，也不可修改，作用固定<br />值可修改，有些环境变量可由用户添加</td>
</tr>
<tr>
<td>位置参数变量</td>
<td>向脚本中传递参数或数据</td>
<td>变量名不能自定义，作用固定，值不可修改，不可自定义添加</td>
</tr>
<tr>
<td>预定义变量</td>
<td>bash已经定义好的变量</td>
<td>变量名不能自定义，作用固定，值不可修改，不可自定义添加</td>
</tr>
</tbody></table>
<ul>
<li>位置参数变量是预定义变量的一种，因为类型较多，所以单独列出</li>
</ul>
<h4 id="本地变量-用户自定义变量"><a href="#本地变量-用户自定义变量" class="headerlink" title="本地变量/用户自定义变量"></a>本地变量/用户自定义变量</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012214734.png" alt="image-20201012214734552" style="zoom:60%;" />

<p>变量默认时字符串类型，叠加可用<code>&quot;$变量&quot;</code>或者<code>$&#123;变量&#125;</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set | more				#set查看系统中所有变量，more分页显示</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215000.png" alt="image-20201012215000428" style="zoom:50%;" />

<p>注意：set查看所有变量,包括PATH</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215213.png" alt="image-20201012215213853" style="zoom:60%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset name			#变量删除unname</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215254.png" alt="image-20201012215254550" style="zoom:67%;" />






<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>变量名称固定，作用固定，可修改值，部分可添加</p>
<h4 id="用户自定义变量与环境变量区别"><a href="#用户自定义变量与环境变量区别" class="headerlink" title="用户自定义变量与环境变量区别"></a>用户自定义变量与环境变量区别</h4><p>作用范围</p>
<ul>
<li>用户自定义变量：当前shell</li>
<li>环境变量：当前shell和这个shell的所有子shell。(若写入配置文件，则在所有shell中生效)</li>
</ul>
<h4 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export 变量名=变量值			#申明变量</span><br><span class="line">env											#查询变量</span><br><span class="line">unset 变量名							#删除变量</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215522.png" alt="image-20201012215522813" style="zoom:60%;" />

<p>env中的内容</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215632.png" alt="image-20201012215632888" style="zoom:50%;" />



<p>子shell内：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215835.png" alt="image-20201012215835568" style="zoom: 67%;" />

<p>父shell的环境变量在子shell内也起作用</p>
<p>使用pstree可查看进程之间的调用关系树</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012215947.png" alt="image-20201012215947052" style="zoom:50%;" />



<h4 id="系统常见环境变量"><a href="#系统常见环境变量" class="headerlink" title="系统常见环境变量"></a>系统常见环境变量</h4><h5 id="PATH：系统查找命令的路径"><a href="#PATH：系统查找命令的路径" class="headerlink" title="PATH：系统查找命令的路径"></a>PATH：系统查找命令的路径</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012220151.png" alt="image-20201012220151533" style="zoom:67%;" />

<p>追加时需注意格式，使用：分隔</p>
<p>ls之类的命令执行不需要绝对路径，是因为在PATH中存有其绝对路径，作用于全局</p>
<p><strong>Q:可执行文件如何不用./直接执行？</strong></p>
<ol>
<li><p>将文件放入bin下 （不推荐）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012220545.png" alt="image-20201012220545019" style="zoom:67%;" />

<p>给文件赋予执行权限后拷贝入bin下</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012220623.png" alt="image-20201012220623060" style="zoom:67%;" />

<p>文件放入bin下后可直接执行，执行时会在path中列出的绝对路径中查找命令/文件</p>
</li>
<li><p>将当前目录追加在PATH后</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012220921.png" alt="image-20201012220921933" style="zoom: 67%;" />

</li>
</ol>
<p>值得注意的是，叠加写入PATH的路径，临时生效，永久需写入配置文件</p>
<h5 id="PS1-定义系统提示符的变量"><a href="#PS1-定义系统提示符的变量" class="headerlink" title="PS1: 定义系统提示符的变量"></a>PS1: 定义系统提示符的变量</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">\d		显示日期。“星期 月 日”</span><br><span class="line">\t		24h制时间。“HH:MM:SS”</span><br><span class="line">\T		12h制时间。“HH:MM:SS”</span><br><span class="line">\A		24h制时间。“HH:MM”</span><br><span class="line">\@		12h制时间。“HH:MM”</span><br><span class="line">\h		简写主机名。默认“localhost”</span><br><span class="line">\u		显示当前用户名</span><br><span class="line">\w		显示当前目录绝对路径</span><br><span class="line">\W		显示当前所在目录最后一个目录</span><br><span class="line">\#		执行的第几个命令</span><br><span class="line">\$		提示符。普通用户-$,root-#</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$PS1</span>				<span class="comment">#默认格式</span></span></span><br><span class="line">[\u@\h \W]\$</span><br></pre></td></tr></table></figure>

<p>修改</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012221415.png" alt="image-20201012221415192" style="zoom:60%;" />

<h3 id="位置参数变量"><a href="#位置参数变量" class="headerlink" title="位置参数变量"></a>位置参数变量</h3><p>位置参数变量是预定义变量的一种，因为类型较多，所以单独列出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">n		n-数字，0代表命令本身,<span class="variable">$1</span>-9分别表示接收到的第一到九个参数,10以上需按<span class="variable">$&#123;n&#125;</span>的格式,<span class="variable">$&#123;10&#125;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">*		代表所有命令，将其看作一个整体</span></span><br><span class="line"><span class="meta">$</span><span class="bash">@		代表所有命令，将每个参数区分对待</span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="comment">#		参数个数</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>$*和$@</p>
<p>假设可执行文件收到参数 11， 22， 33， 44， 55（均为字符串）</p>
<p>则$*类似’1122334455’，$@类似{11,22,33,44,55}</p>
</li>
</ul>
<p>eg1.</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012221740.png" alt="image-20201012221740590" style="zoom:67%;" />

<p>$0命令本身，$1接收到的第一个命令，以此类推</p>
<p>eg2. 一个运算例子</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012222035.png" alt="image-20201012222000366" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">sum=$(($1+$2))                  #数值运算格式$(())</span><br><span class="line">echo $sum</span><br></pre></td></tr></table></figure>

<p>eg3. for循环测试$*和$@</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012222408.png" alt="image-20201012222408867" style="zoom:50%;" />

<p>for循环遍历$*,一个整体同时输出<br>for循环遍历$@，内容单独挨个输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;parameters numer:$#&quot;</span><br><span class="line">echo &quot;the parameters is:$*&quot;</span><br><span class="line">echo -e &quot;the parameters is:$@\n&quot;			#echo输出特殊字符 -e</span><br><span class="line"></span><br><span class="line">for i in &quot;$*&quot;</span><br><span class="line">    do</span><br><span class="line">        echo &quot;the parameters is:$i&quot;</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">for j in &quot;$@&quot;</span><br><span class="line">    do</span><br><span class="line">        echo &quot;the parameter$x is:$j&quot;</span><br><span class="line">        x=$(($x+1))</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>





<h3 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h3><h4 id="预定义变量-1"><a href="#预定义变量-1" class="headerlink" title="预定义变量"></a>预定义变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">?		最后一次执行命令返回的状态。正确-0，错误-对应错误的数字代码</span></span><br><span class="line"><span class="meta">$</span><span class="bash">$		当前进程进程号PID</span></span><br><span class="line"><span class="meta">$</span><span class="bash">!	后台运行的最后一个进程的进程号PID</span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231527.png" alt="image-20201012222936620" style="zoom: 50%;" />

<p>命令 &amp;表示将命令放在后台执行，由于top是专用于前台与用户交互 查看系统状态的命令，所以一放入后台就停止运行。想要恢复到前台运行可使用<code>fg 工作号</code>(工作号就是[]内的数字)，可通过<code>jobs</code>查看后台正在运行/中止的命令。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012224044.png" alt="image-20201012224044036" style="zoom:67%;" />



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;the current process is $$&quot;			#当前进程PID</span><br><span class="line">find /root -name hello.sh &amp;			#&amp;表示将进程挂在后台执行</span><br><span class="line">echo &quot;$(jobs)&quot;</span><br><span class="line">echo &quot;the last one Daemon process is $!&quot;		#最后一个后台进程PID</span><br></pre></td></tr></table></figure>





<h5 id="主动接收键盘输入read"><a href="#主动接收键盘输入read" class="headerlink" title="主动接收键盘输入read"></a>主动接收键盘输入read</h5><p>echo只能被动等待，不能输出提示信息引导用户输入，不够友好</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">read [选项] [变量名]</span><br><span class="line">			-p &quot;提示信息&quot;</span><br><span class="line">			-t 秒数  等待用户输入秒数</span><br><span class="line">			-n 			接受参数数量/字符数</span><br><span class="line">      -s			隐藏输入，例如输入密码时可用</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012224603.png" alt="image-20201012224603790"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">readtest.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">read -t 30 -p &quot;Please input your name:&quot; name</span><br><span class="line">echo &quot;Name is $name&quot;</span><br><span class="line"></span><br><span class="line">read -s  -t 30 -p &quot;Please input your passwd:&quot; password</span><br><span class="line">echo -e &quot;\nPasswd is $password&quot;</span><br><span class="line"></span><br><span class="line">read -n 1 -t 30 -p &quot;login?[y/n]:&quot; choice			#-n 1 接受1个参数后立刻执行下一条</span><br><span class="line">echo -e &quot;\n&quot;</span><br></pre></td></tr></table></figure>



<h2 id="bash的运算符"><a href="#bash的运算符" class="headerlink" title="bash的运算符"></a>bash的运算符</h2><h3 id="数值运算与运算符"><a href="#数值运算与运算符" class="headerlink" title="数值运算与运算符"></a>数值运算与运算符</h3><h4 id="声明变量类型-declare"><a href="#声明变量类型-declare" class="headerlink" title="声明变量类型 declare"></a>声明变量类型 declare</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare [+-][选项] 变量名</span><br><span class="line">				-：给变量设置属性</span><br><span class="line">				+：给变量取消属性</span><br><span class="line">				-i:将变量声明为整数型</span><br><span class="line">				-x:将变量申明为环境变量</span><br><span class="line">				-p:显示变量被声明的类型</span><br></pre></td></tr></table></figure>

<p>变量默认类型为字符型，要想进行<strong>数值运算</strong>，需将变量声明为整型,使用-i参数</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012225128.png" alt="image-20201012225128291" style="zoom:67%;" />



<p>环境变量+x</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012224930.png" alt="image-20201012224930505" style="zoom:67%;" />

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> aa			<span class="comment">#将aa声明为环境变量</span></span><br><span class="line"><span class="built_in">declare</span> -p aa		<span class="comment">#查看aa类型，x--环境变量</span></span><br><span class="line"><span class="built_in">declare</span> +x aa			<span class="comment">#取消aa的环境变量属性</span></span><br></pre></td></tr></table></figure>

<p>其他数值运算方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $(($aa+$bb)) 		#$((运算式))，推荐</span><br><span class="line">echo $[$aa+$bb] 			#$[运算式]，不建议容易与$(命令)混</span><br><span class="line">echo $(expr $aa + $bb)		#$(expr 运算式)，注意+左右有空格</span><br></pre></td></tr></table></figure>



<h4 id="运算优先级"><a href="#运算优先级" class="headerlink" title="运算优先级"></a>运算优先级</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093931.png" alt="image-20201003231448357" style="zoom:67%;" />

<p>优先级数字越大，优先级越高</p>
<h3 id="变量测试与内容替换"><a href="#变量测试与内容替换" class="headerlink" title="变量测试与内容替换"></a>变量测试与内容替换</h3><h4 id="置换格式"><a href="#置换格式" class="headerlink" title="置换格式"></a>置换格式</h4><p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093932.png" alt="image-20201003231608574"></p>
<p>主要用于通过x的值检测y值的状态（未设置，空，有值），多用于脚本中自动判断，类似if-else</p>
<p>一些小规律：（表比较难记，建议作为工具表，随用随查）</p>
<ul>
<li><p>：与没有：</p>
</li>
<li><p>+-  结果相反</p>
<p>=   不仅改变x还改变y</p>
</li>
<li><p>?报错</p>
</li>
</ul>
<h2 id="环境变量配置文件"><a href="#环境变量配置文件" class="headerlink" title="环境变量配置文件"></a>环境变量配置文件</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>环境变量配置文件-每次开机生效</p>
<h5 id="source"><a href="#source" class="headerlink" title="source"></a>source</h5><p>更改环境变量后重新登陆生效，source可省略此过程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source 配置文件</span><br><span class="line">或</span><br><span class="line">. 配置文件		#.是source的缩写</span><br></pre></td></tr></table></figure>



<h4 id="环境变量配置文件-1"><a href="#环境变量配置文件-1" class="headerlink" title="环境变量配置文件"></a>环境变量配置文件</h4><p>定义对系统os生效的系统默认环境变量，如PATH，HISTSIZE，PS1，HOSTNAME等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$PATH</span></span></span><br><span class="line">/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/jen/.local/bin:/home/jen/bin</span><br></pre></td></tr></table></figure>

<p>变量叠加修改：一次性,重启开机后失效，想要永久生效需写入配置文件</p>
<h5 id="常见配置文件"><a href="#常见配置文件" class="headerlink" title="常见配置文件"></a>常见配置文件</h5><p><code>/etc/profile</code></p>
<p>``/etc/profile.d/*.sh`</p>
<p> <code>/etc/bashrc</code></p>
<p> <code>~/.bashrc</code>, </p>
<p> <code>~/.bash_profile</code></p>
<ul>
<li>/etc…                 所有用户都生效</li>
<li>~/.bash…          家目录，当前用户生效，隐藏文件</li>
</ul>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093933.png" alt="image-20201002163004666" style="zoom:67%;" />

<h4 id="访问路径1"><a href="#访问路径1" class="headerlink" title="访问路径1"></a>访问路径1</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093934.png" alt="image-20201004104239463" style="zoom:67%;" />

<ul>
<li><p>/etc/profile作用：</p>
<p>USER变量，LOGINNAME变量，MAIL变量，PATH变量，HOSTNAME变量，HISTSIZE变量</p>
<p>PATH：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012225926.png" alt="image-20201012225926614" style="zoom:50%;" />

<p>USER，LOGINNAME，MAIL</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012230040.png" alt="image-20201012230040443" style="zoom:50%;" />

<p>HOSTNAME, HISTSIZE .HISTCONTROL</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012230114.png" alt="image-20201012230114836" style="zoom:67%;" />

<p>umask</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012230201.png" alt="image-20201012230201241" style="zoom:67%;" />

<p>调用/etc/profile.d/*.sh文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012230257.png" alt="image-20201012230257888" style="zoom:50%;" />

<p>下面的程序段使得管理员才能执行/usr/sbin下的命令</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012230423.png" alt="image-20201012230423363" style="zoom:50%;" />
</li>
<li><p>/etc/profile.d/*.sh</p>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231528.png" alt="image-20201012230636733" style="zoom:67%;" />

<ul>
<li><p>lang.sh-与系统语言有关</p>
<p>/etc/locale.conf调用+path追加</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231529.png" alt="image-20201012230911559" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231530.png" alt="image-20201012231000855" style="zoom: 50%;" />





</li>
</ul>
<h4 id="访问路径2"><a href="#访问路径2" class="headerlink" title="访问路径2"></a>访问路径2</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093935.png" alt="image-20201004110954353" style="zoom: 50%;" />

<ul>
<li><p>~/.bash_profile</p>
<p>追加PATH.后Path会覆盖原值，但./bash_profile中使用追加</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231413.png" alt="image-20201012231413254"></p>
</li>
</ul>
<ul>
<li><p>~/.bashrc</p>
<p>别名声明,可写在其他文件内，注意作用范围</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231518.png" alt="image-20201012231518249" style="zoom:67%;" />
</li>
<li><p>/etc/bashrc</p>
<p>PS1变量</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231724.png" alt="image-20201012231724059" style="zoom:50%;" />

<p>umask</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231945.png" alt="image-20201012231945496" style="zoom:60%;" />

<p>PATH变量</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012231926.png" alt="image-20201012231926225" style="zoom:60%;" />

<p>调用/etc/profile.d/*.sh（仅在免登录shell中调用）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201012232009.png" alt="image-20201012232009695" style="zoom:67%;" />







</li>
</ul>
<h3 id="其他配置文件与登录信息"><a href="#其他配置文件与登录信息" class="headerlink" title="其他配置文件与登录信息"></a>其他配置文件与登录信息</h3><h4 id="注销时生效的环境变量配置文件"><a href="#注销时生效的环境变量配置文件" class="headerlink" title="注销时生效的环境变量配置文件"></a>注销时生效的环境变量配置文件</h4><p>  <code>~/.bash_logout</code></p>
<h4 id="历史命令记录配置文件"><a href="#历史命令记录配置文件" class="headerlink" title="历史命令记录配置文件"></a>历史命令记录配置文件</h4><p>~/bash_history</p>
<ul>
<li>重要排错手段，一般不建议删除</li>
<li>mysql设置密码时会记录在配置文件中</li>
</ul>
<h4 id="shell中登录信息"><a href="#shell中登录信息" class="headerlink" title="shell中登录信息"></a>shell中登录信息</h4><h5 id="本地终端欢迎信息：-etc-issue"><a href="#本地终端欢迎信息：-etc-issue" class="headerlink" title="本地终端欢迎信息：/etc.issue"></a>本地终端欢迎信息：/etc.issue</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011093936.png" alt="image-20201004111344889" style="zoom: 50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">/etc/issue</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br></pre></td></tr></table></figure>

<p>修改后只对本地生效</p>
<ul>
<li><p>终端号</p>
<p>每个虚拟控制台登录都会产生一个<code>tty1-7</code>, 每一个远程连接都会产生一个<code>pts/0-255</code>.</p>
</li>
</ul>
<h5 id="远程终端欢迎信息：-etc-issue-net"><a href="#远程终端欢迎信息：-etc-issue-net" class="headerlink" title="远程终端欢迎信息：/etc/issue.net"></a>远程终端欢迎信息：/etc/issue.net</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/issue.net</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br></pre></td></tr></table></figure>

<ul>
<li>转义符在此文件中不能使用</li>
<li>是否显示欢迎信息，由ssh配置文件**/etc/ssh/sshd_config**决定（加入Banner /etc/issue.net行才可显示，需重启ssh服务）。默认不生效</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_profile</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> no default banner path</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Banner none</span></span><br><span class="line">Banner /etc/issue.net</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service ssh restart			#重启ssh服务</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">退出后重新登录可见欢迎信息，由于issue.net中转义符不会生效，故原样输出</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line">Last login: Sun Oct  4 19:20:24 2020 from 192.168.52.x</span><br><span class="line">[root@localhost ~]# </span><br></pre></td></tr></table></figure>

<ul>
<li><p>登陆后欢迎信息：/etc/motd</p>
<p>本地/远程均显示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cat /etc/motd</span></span><br><span class="line">Do not operate unauthorized,thanks</span><br></pre></td></tr></table></figure>

<p>可自定义，不建议写welcome to …，国外有个报道黑客入侵了一个服务器，而这个服务器却给出了欢迎登录的信息，因此法院不做任何裁决。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">重新登陆可见</span></span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br><span class="line">Last login: Sun Oct  4 19:27:18 2020 from 192.168.52.1</span><br><span class="line"></span><br><span class="line">Do not operate unauthorized,thanks</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>远程登录欢迎信息应尽可能删减敏感信息</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux基础_3.用户管理与用户组管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:21:44" itemprop="dateCreated datePublished" datetime="2020-10-11T09:21:44+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:07" itemprop="dateModified" datetime="2020-10-13T12:58:07+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>


<h2 id="用户配置文件"><a href="#用户配置文件" class="headerlink" title="用户配置文件"></a>用户配置文件</h2><p>用户配置文件：查看和修改用户信息</p>
<h4 id="passwd-7个参数"><a href="#passwd-7个参数" class="headerlink" title="passwd(7个参数)"></a><strong>passwd</strong>(7个参数)</h4><p>   <code>man 5 passwd </code>查看配置文件格式</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011221712.png" alt="image-20201011221712295" style="zoom:67%;" />L</p>
<ul>
<li><p>UID（用户ID）</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011205156.png" alt="image-20201011205149896" style="zoom:50%;" />

<p>centos7普通用户从1000开始</p>
</li>
<li><p>GID（组ID）</p>
<p>初始组：用户同名组，只能有一个，可修改</p>
<p>附加组：可加入其他用户组，拥有其权限，多个</p>
</li>
<li><p>GECOS（用户说明）</p>
</li>
<li><p>Directory（家目录）</p>
<p>/home/用户名/和/root/</p>
<p>初始登录目录，目录权限普通用户700，root 500（ll 目录 -d）</p>
</li>
<li><p>shell（命令解释器）</p>
<p>/bin/bash/</p>
<p>/sbin/nologin/        伪用户</p>
</li>
</ul>
<h4 id="shadow-9个参数"><a href="#shadow-9个参数" class="headerlink" title="shadow(9个参数)"></a><strong>shadow</strong>(9个参数)</h4><p>   用户名：加密密码：密码最后修改日期：修改间隔：有效期：密码到期警告时间（前）：过期宽限时间（后）：账号失效时间：保留</p>
<p><code>cat /etc/shadow</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011222247.png" alt="image-20201011222247865" style="zoom: 50%;" />

<ul>
<li><p>加密密码：sha512，!!或*表示无密码。可能被爆破但密码加盐撞库成功可能性不大</p>
</li>
<li><p>日期均为时间戳（1970-01-01到当天的天数）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date -d <span class="string">&quot;1970-01-01 16066 days&quot;</span>		<span class="comment">#时间戳-日期</span></span><br><span class="line"><span class="built_in">echo</span> $(($(date--date=&quot;<span class="number">2014</span>/<span class="number">01</span>/<span class="number">06</span>&quot;+%s)/<span class="number">86400</span>+<span class="number">1</span>))		<span class="comment">#日期-时间戳</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="etc-group"><a href="#etc-group" class="headerlink" title="/etc/group"></a>/etc/<strong>group</strong></h4><p>   组名：组密码：GID：组中附加用户</p>
<p><code>cat /etc/group</code>    </p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011222437.png" alt="image-20201011222437758" style="zoom: 50%;" />



<h4 id="etc-gshadow"><a href="#etc-gshadow" class="headerlink" title="/etc/gshadow"></a>/etc/gshadow</h4><p>   组名：组密码：组管理管名：组中附加用户</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011222606.png" alt="image-20201011222606938" style="zoom:50%;" />

<ul>
<li>密码为空可用!或不填</li>
<li>密码修改可用gpasswd group名，类似passwd</li>
<li>组切换可使用newgrp 组名，类似su</li>
</ul>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beinan:!::linuxsir</span><br><span class="line">linuxsir:oUS&#x2F;q7NH75RhQ::linuxsir</span><br></pre></td></tr></table></figure>

<p>第一字段：这个例子中，有两个用户组beinan用linuxsir<br>第二字段：用户组的密码，beinan用户组无密码；linuxsir用户组有已经，已经加密；<br>第三字段：用户组管理者，两者都为空；<br>第四字段：beinan用户组所拥有的成员是linuxsir ，然后还要对照一下/etc/group和/etc/passwd 查看是否还有其它用户，一般默认添加的用户，有时同时也会创建用户组和用户名同名称； linuxsir 用户组有成员linuxisir ；</p>
<h2 id="用户管理相关文件"><a href="#用户管理相关文件" class="headerlink" title="用户管理相关文件"></a>用户管理相关文件</h2><h4 id="用户家目录"><a href="#用户家目录" class="headerlink" title="用户家目录"></a>用户家目录</h4><p>   初始登录位置</p>
<p>   普通用户：/home/用户，所属者和所属组均为此用户，权限700</p>
<p>   超级用户：/root/，—-，权限550</p>
<p>   注意：普通用户变为超级用户只需在/etc/passwd将uid变为0,重新登录家目录不变，权限升级</p>
<h4 id="用户邮箱"><a href="#用户邮箱" class="headerlink" title="用户邮箱"></a>用户邮箱</h4><p>/var/spool/mail/用户名</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011223754.png" alt="image-20201011223754631" style="zoom:60%;" />



<h4 id="用户模板文件-etc-skel"><a href="#用户模板文件-etc-skel" class="headerlink" title="用户模板文件 /etc/skel/"></a>用户模板文件 /etc/skel/</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011224150.png" alt="image-20201011224150918" style="zoom: 50%;" />

<p>​      </p>
<h2 id="用户管理命令"><a href="#用户管理命令" class="headerlink" title="用户管理命令"></a>用户管理命令</h2><h4 id="添加用户useradd"><a href="#添加用户useradd" class="headerlink" title="添加用户useradd"></a>添加用户useradd</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011224451.png" alt="image-20201011224451524" style="zoom:60%;" />

<p>添加用户涉及的文件</p>
<p>手动创建: 指定uid（-u), 用户组(-g初始组gid,-G附加组），备注(-c)，家目录(-d)，shell(-s)</p>
 <img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011225017.png" alt="image-20201011225017066" style="zoom: 50%;" />

<p>  缺省选项/默认</p>
<p>   /etc/default/useradd</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011225354.png" alt="image-20201011225354582" style="zoom: 60%;" />

<p>   /etc/login.defs</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011225720.png" alt="image-20201011225720071" style="zoom: 60%;" />



<h4 id="修改密码passwd"><a href="#修改密码passwd" class="headerlink" title="修改密码passwd"></a>修改密码passwd</h4><p>   普通用户修改自己密码：passwd</p>
<p>   管理员修改他人：passwd user</p>
<p>   管理员修改密码可无视密码复杂度要求，但普通用户必须遵循</p>
<h5 id="查看密码状态"><a href="#查看密码状态" class="headerlink" title="查看密码状态"></a>查看密码状态</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011225823.png" alt="image-20201011225823636" style="zoom:67%;" />

<p>  用户名 密码设定时间 修改间隔 密码有效期 警告时间 密码不失效</p>
<h5 id="锁定用户-amp-解锁"><a href="#锁定用户-amp-解锁" class="headerlink" title="锁定用户&amp;解锁"></a>锁定用户&amp;解锁</h5><p><code>passwd -l user2</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011230035.png" alt="image-20201011230035392" style="zoom:67%;" />

<p>密码前加入!!使密码失效，无法登陆</p>
<p><code>passwd -u user2</code>    解锁</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011230157.png" alt="image-20201011230156958" style="zoom:67%;" />

<p>shell编程批量添加密码的一点启发</p>
<p><code>echo &quot;123&quot;|passwd --stdin user1</code>        使用前者输出作为后者输入代替标准输入</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011230614.png" alt="image-20201011230614044" style="zoom:67%;" />



<h5 id="锁定用户的一些方法小结"><a href="#锁定用户的一些方法小结" class="headerlink" title="锁定用户的一些方法小结"></a>锁定用户的一些方法小结</h5><pre><code>  1. passwd文件shell 改为/sbin/nologin
  2. shadow密码前加! 换算失效
  3. 注释用户</code></pre>
<h4 id="修改用户信息usermod"><a href="#修改用户信息usermod" class="headerlink" title="修改用户信息usermod"></a>修改用户信息usermod</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011230817.png" alt="image-20201011230817906" style="zoom: 50%;" />

   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">usermod -c &quot;tede&quot; user1</span><br><span class="line">usermod -G root user1</span><br><span class="line">usermod -L user1</span><br><span class="line">usermod -U user1 </span><br></pre></td></tr></table></figure>



<h4 id="修改密码信息chage"><a href="#修改密码信息chage" class="headerlink" title="修改密码信息chage"></a>修改密码信息chage</h4><p> <code> chage -l jen</code>        #查看密码状态</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011231207.png" alt="image-20201011231207328" style="zoom:60%;" />

<p><code>chage -d 0 user</code>    #要求用户一登录就修改密码</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011231449.png" alt="image-20201011231449077" style="zoom:50%;" />

<h4 id="删除用户userdel"><a href="#删除用户userdel" class="headerlink" title="删除用户userdel"></a>删除用户userdel</h4><p><code>userdel -r username</code>    -r彻底删除</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011231610.png" alt="image-20201011231610779" style="zoom: 60%;" />

<p>   验证完全删除的方法：再次添加不报错</p>
<h4 id="查询id"><a href="#查询id" class="headerlink" title="查询id"></a>查询id</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011231744.png" alt="image-20201011231744228" style="zoom:65%;" />

<h4 id="切换用户su"><a href="#切换用户su" class="headerlink" title="切换用户su"></a>切换用户su</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - root											#- 连带env切换</span><br><span class="line">su - root -c &quot;useradd user3&quot;	#-c 不切换用户身份，执行一次命令</span><br></pre></td></tr></table></figure>



<h2 id="用户组管理命令"><a href="#用户组管理命令" class="headerlink" title="用户组管理命令"></a>用户组管理命令</h2><h4 id="添加用户组groupadd"><a href="#添加用户组groupadd" class="headerlink" title="添加用户组groupadd"></a>添加用户组groupadd</h4><p><code>groupadd tg</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011231952.png" alt="image-20201011231952262" style="zoom:65%;" />

<p>帮助文档</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011232100.png" alt="image-20201011232100246" style="zoom:50%;" />

<h4 id="groupmod"><a href="#groupmod" class="headerlink" title="groupmod"></a>groupmod</h4><p><code>groupmod -n lamp tg</code>        修改组名，一般不用</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011232223.png" alt="image-20201011232222988" style="zoom:67%;" />



<h4 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel 组名</span><br></pre></td></tr></table></figure>

<p>   组内有初始用户，不可删除，附加用户不影响</p>
<p><code>useradd tt -g lamp</code>        <code>useradd tt1 -G lamp</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011232547.png" alt="image-20201011232547136" style="zoom:60%;" />

<p>此时tt1的初始组是tt1,附加组是lamp。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011232746.png" alt="image-20201011232746661" style="zoom: 67%;" />

<p>如果像删除组lamp,会报错lamp是tt用户的初始组无法删除</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011232851.png" alt="image-20201011232851481" style="zoom: 67%;" />

<p>使用<code>userdel -r tt</code>删除用户tt后，再次删除组lamp即可，此时组lamp不受tt1的限制</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011233116.png" alt="image-20201011233116879" style="zoom:67%;" />



<h4 id="修改已存在用户附加组gpasswd"><a href="#修改已存在用户附加组gpasswd" class="headerlink" title="修改已存在用户附加组gpasswd"></a>修改已存在用户附加组gpasswd</h4><p>除了创建用户时指定用户的附加组，使用usermod指定用户附加组，可使用gpasswd将已有用户加入附加组</p>
<p><code>gpasswd -a user1 lamp</code>        #参数-a   user1加入附加组lamp</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011233523.png" alt="image-20201011233523504" style="zoom:67%;" />

<p><code>gpasswd -d user1 lamp</code>            #将用户从附加组中移除</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011233716.png" alt="image-20201011233716097" style="zoom:67%;" />








      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-2-vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-2-vim/" class="post-title-link" itemprop="url">linux基础_2.vim</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:21:24" itemprop="dateCreated datePublished" datetime="2020-10-11T09:21:24+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:56:40" itemprop="dateModified" datetime="2020-10-13T12:56:40+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h1 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h1><h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:set nu&#x2F;nonu</span><br><span class="line">gg&#x2F;G	#到首行&#x2F;末行</span><br><span class="line">nG&#x2F;:n   #到第n行</span><br><span class="line">0&#x2F;$		#移至行首&#x2F;尾</span><br></pre></td></tr></table></figure>

<h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><table>
<thead>
<tr>
<th>a</th>
<th>A</th>
<th>i</th>
<th>I</th>
<th>o</th>
<th>O</th>
</tr>
</thead>
<tbody><tr>
<td>光标所在字符后</td>
<td>行尾</td>
<td>—-字符前</td>
<td>行首</td>
<td>下插入新行</td>
<td>上插入新行</td>
</tr>
</tbody></table>
<h4 id="删除-拷贝-剪切"><a href="#删除-拷贝-剪切" class="headerlink" title="删除/拷贝/剪切"></a>删除/拷贝/剪切</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">删除：</span><br><span class="line">dG	删除光标所在行到文末内容</span><br><span class="line">D	删除----------行尾内容</span><br><span class="line">:2,5d	删除第2到5行</span><br><span class="line">x	删除光标所在处字符</span><br><span class="line">nx	删除光标所在后n个字符</span><br><span class="line"></span><br><span class="line">复制：</span><br><span class="line">yy	复制当前行</span><br><span class="line">nyy	复制当前行以下n行</span><br><span class="line">dd+p剪切</span><br><span class="line">dd ndd</span><br><span class="line">p,P	粘贴在当前光标所在行下或行上</span><br><span class="line">替换:R	从光标所在处开始替换，按esc结束</span><br><span class="line">复原:u</span><br></pre></td></tr></table></figure>

<h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:&#x2F;abc	文件中搜索abc	</span><br><span class="line">n		出现的下一个位置</span><br><span class="line">:%s&#x2F;old&#x2F;new&#x2F;g	全文替换指定字符串</span><br><span class="line">:n1,n2s&#x2F;old&#x2F;new&#x2F;g	在一定范围内替换</span><br></pre></td></tr></table></figure>

<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:n1,n2s&#x2F;^&#x2F;#&#x2F;g		#区块注释</span><br><span class="line">:n1,n2s&#x2F;#&#x2F; &#x2F;g		#取消注释</span><br><span class="line">:n1,n2s&#x2F;^&#x2F;\&#x2F;\&#x2F;&#x2F;g</span><br></pre></td></tr></table></figure>

<h4 id="替换ab"><a href="#替换ab" class="headerlink" title="替换ab"></a>替换ab</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab mymail samlee@lampbrother.nat</span><br></pre></td></tr></table></figure>

<h4 id="导入命令执行"><a href="#导入命令执行" class="headerlink" title="导入命令执行"></a>导入命令执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r 文件路径	#导入文件</span><br><span class="line">r !命令	 #导入命令执行结果</span><br></pre></td></tr></table></figure>

<h4 id="定义快捷键"><a href="#定义快捷键" class="headerlink" title="定义快捷键"></a>定义快捷键</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:map 快捷键 命令</span><br><span class="line">:map ^P(ctrl+^+v) I#&lt;ESC&gt;	#注释快捷键</span><br><span class="line">:map ^B x	删除行末</span><br></pre></td></tr></table></figure>

<h4 id="默认配置文件"><a href="#默认配置文件" class="headerlink" title="默认配置文件"></a>默认配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.vimrc-&gt;&#x2F;home&#x2F;user&#x2F;.vimrc</span><br><span class="line">	  -&gt;&#x2F;root&#x2F;.vimrc</span><br></pre></td></tr></table></figure>

<p>eg.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set nu</span><br><span class="line">map ^p I#&lt;ESC&gt;</span><br><span class="line">ab mymail  xxxx@xxx.com</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/linux%E5%9F%BA%E7%A1%80-1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/linux%E5%9F%BA%E7%A1%80-1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">linux基础_1.常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-11 09:21:08" itemprop="dateCreated datePublished" datetime="2020-10-11T09:21:08+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:57:55" itemprop="dateModified" datetime="2020-10-13T12:57:55+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="目录处理命令"><a href="#目录处理命令" class="headerlink" title="目录处理命令"></a>目录处理命令</h2><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><p>TOC<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011104521.png" alt="image-20201011104521670" style="zoom: 50%;" /></p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls  []</span><br><span class="line">		-a	显示隐藏文件</span><br><span class="line">   	-h	人性化阅读，文件大小转为MB&#x2F;GB，原为数据块</span><br><span class="line">   	-l	相当于ll，长列表类型展示文件信息</span><br><span class="line">   	-d	显示目录</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ls命令查询得到的文件大小部分</p>
<p>文件–文件大小</p>
<p>目录–目录文件名占用的字节数，并非目录内数据大小</p>
</li>
</ul>
<p><code>ls -al </code>和 <code>ls -alh</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011104543.png" alt="image-20201011104543195" style="zoom: 45%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011105048.png" alt="image-20201011105048302" style="zoom:48%;" />

<p><code>ls -dl lib    </code>    以长列表形式显示目录lib</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011104656.png" alt="image-20201011104656879" style="zoom:58%;" />


<h4 id="mkdir和rmdir"><a href="#mkdir和rmdir" class="headerlink" title="mkdir和rmdir"></a>mkdir和rmdir</h4>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p 递归创建目录</span><br><span class="line">rmdir 删除目录 </span><br><span class="line">rm -rf  强制删除						</span><br></pre></td></tr></table></figure>

<p><code>mkdir -p test/test1</code>    ，假设test目录不存在，则递归创建，先创建test,再创建test1</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011105801.png" alt="image-20201011105801725" style="zoom:67%;" />

<p>如果目录下有内容，删除父目录会报错</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011110231.png" alt="image-20201011110231944" style="zoom:60%;" />

<p>原可用<code>rmdir -f</code>强制删除，但在centos7中不再支持该选项。不过使用<code>rm -rf</code>也可以达到同样的效果</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011110430.png" alt="image-20201011110430489" style="zoom:60%;" />



<h4 id="pwd显示当前目录"><a href="#pwd显示当前目录" class="headerlink" title="pwd显示当前目录"></a>pwd显示当前目录</h4><h4 id="cp拷贝"><a href="#cp拷贝" class="headerlink" title="cp拷贝"></a>cp拷贝</h4>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp	[] 源文件 目标文件路径</span><br><span class="line">		-r	拷贝目录</span><br><span class="line">   	-p	拷贝属性</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011110802.png" alt="image-20201011110801998" style="zoom:50%;" />

<p>拷贝目录test到当前路径下<code> cp -r test test1</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011111141.png" alt="image-20201011111141396" style="zoom:50%;" />

<p>但是两个目录属性不同(创建时间不一)，只复制了内容。使用<code>cp -pr test test2</code>拷贝得到</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011111700.png" alt="image-20201011111700328" style="zoom:50%;" />

<p>复制目录不加<code>-r</code>参数会出现如下报错：cp: omitting directory ‘test’</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011111737.png" alt="image-20201011111713682" style="zoom:60%;" />



<h4 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h4>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm	-r	删除目录</span><br><span class="line">   	-f  强制删除</span><br></pre></td></tr></table></figure>

<h4 id="ln链接"><a href="#ln链接" class="headerlink" title="ln链接"></a>ln链接</h4><blockquote>
<p>摘自<a target="_blank" rel="noopener" href="https://man.linuxde.net/ln">linux命令大全-ln</a></p>
<p>Linux具有为一个文件起多个名字的功能，称为链接。被链接的文件可以存放在相同的目录下，但是必须有不同的文件名，而不用在硬盘上为同样的数据重复备份。另外，被链接的文件也可以有相同的文件名，但是存放在不同的目录下，这样只要对一个目录下的该文件进行修改，就可以完成对所有目录下同名链接文件的修改。对于某个文件的各链接文件，我们可以给它们指定不同的存取权限，以控制对信息的共享和增强安全性。文件链接有两种形式，即硬链接和符号链接。</p>
<p><strong>硬链接</strong></p>
<p>​        创建硬链接后，己经存在的文件的I节点号（Inode）会被多个目录文件项使用。一个文件的硬链接数可以在目录的长列表格式的第二列中看到，无额外链接的文件的链接数为l。</p>
<p>​        在默认情况下，ln命令创建硬链接。ln命令会增加链接数，<a target="_blank" rel="noopener" href="http://man.linuxde.net/rm">rm</a>命令会减少链接数。一个文件除非链接数为0，否则不会从文件系统中被物理地删除。</p>
<p>对硬链接有如下限制：</p>
<ul>
<li>不能对目录文件做硬链接。</li>
<li>不能在不同的文件系统之间做硬链接。就是说，链接文件和被链接文件必须位于同一个文件系统中。</li>
</ul>
<p><strong>符号链接/软链接</strong></p>
<p>符号链接也称为软链接，是将一个路径名链接到一个文件。这些文件是一种特别类型的文件。事实上，它只是一个文本文件（如图中的abc文件），其中包含它提供链接的另一个文件的路径名。另一个文件是实际包含所有数据的文件。所有读、写文件内容的命令被用于符号链接时，将沿着链接方向前进来访问实际的文件。</p>
<p>​        与硬链接不同的是，符号链接确实是一个新文件，当然它具有不同的I节点号；而硬链接并没有建立新文件。</p>
<p>​        符号链接没有硬链接的限制，可以对目录文件做符号链接，也可以在不同文件系统之间做符号链接。</p>
<p>符号链接保持了链接与源文件或目录之间的区别：</p>
<ul>
<li>删除源文件或目录，只删除了数据，不会删除链接。一旦以同样文件名创建了源文件，链接将继续指向该文件的新数据。</li>
<li>在目录长列表中，符号链接作为一种特殊的文件类型显示出来，其第一个字母是l。</li>
<li>符号链接的大小是其链接文件的路径名中的字节数。</li>
<li>当用<code>ln -s</code>命令列出文件时，可以看到符号链接名后有一个箭头指向源文件或目录，例如<code>lrwxrwxrwx … 14 jun 20 10:20 /etc/motd-&gt;/original_file</code>其中，表示“文件大小”的数字“14”恰好说明源文件名<code>original_file</code>由14个字符构成。</li>
</ul>
</blockquote>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln [选项] target link</span><br><span class="line">   -s 生成软连接，类似win快捷方式，权限ugo均rwx,文件小，删除源文件软链接失效</span><br></pre></td></tr></table></figure>

<ul>
<li>默认无参数时生成硬链接</li>
<li>target：指定连接的源文件。创建软连接，“源文件”可以是文件或者目录。创建硬连接时，则“源文件”参数只能是文件；</li>
<li>用<code>ln -s</code>命令建立符号链接时，源文件最好用绝对路径名。这样可以在任何工作目录下进行符号链接。而当源文件用相对路径时，如果当前的工作路径与要创建的符号链接文件所在路径不同，就不能进行链接。</li>
</ul>
<h5 id="创建一个硬链接实例"><a href="#创建一个硬链接实例" class="headerlink" title="创建一个硬链接实例"></a>创建一个硬链接实例</h5><p>将目录/root/temp/test下的文件aa链接到/root/temp/test2下的文件bb(执行命令前，bb并不存在)</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011113105.png" alt="image-20201011113105060" style="zoom:50%;" />

<p>查看两个文件aa和bb，-i参数表示显示Node节点号。可见两个文件节点号相同，链接数+1（无额外链接的文件链接数=1），文件类型位置没有特殊标记。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011113204.png" alt="image-20201011113204473" style="zoom:67%;" />



<h5 id="创建一个软链接实例"><a href="#创建一个软链接实例" class="headerlink" title="创建一个软链接实例"></a>创建一个软链接实例</h5><p>将目录test1链接到test2下的符号链接文件ab(无需事先创建，执行命令时写明链接文件路径即可)，即使./test2/ab指向目录./test1。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;root&#x2F;temp&#x2F;test1 &#x2F;root&#x2F;temp&#x2F;test2&#x2F;ab</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011120135.png" alt="image-20201011115420891" style="zoom:50%;" />

<p>此时test1中存放的文件可通过软链接文件ab访问。但实际上两个目录inode不同，证明符号链接是一个新文件。文件类型为l,代表软链接</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011120136.png" alt="image-20201011115810534" style="zoom:67%;" />

<p>目录内文件inode相同是因为通过ab访问的文件aa的过程就是ab沿着符号链接的方向访问实际目录test1内的aa。</p>
<h4 id="目录作用"><a href="#目录作用" class="headerlink" title="目录作用"></a>目录作用</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011121001.png" alt="image-20201011121001014" style="zoom:67%;" />

<table>
<thead>
<tr>
<th align="center">目录</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/bin/</td>
<td>从存放系统命令（$#）</td>
</tr>
<tr>
<td align="center">/sbin/</td>
<td>与系统环境相关的命令（#)</td>
</tr>
<tr>
<td align="center">/usr/</td>
<td>系统软件资源目录</td>
</tr>
<tr>
<td align="center">/usr/bin/</td>
<td>存放系统命令（与系统启动无关）</td>
</tr>
<tr>
<td align="center">/usr/sbin/</td>
<td>根系统文件中不必要的管理命令</td>
</tr>
<tr>
<td align="center">/boot/</td>
<td>系统启动目录（内核文件，启动引导程序，group文件）</td>
</tr>
<tr>
<td align="center">/dev/</td>
<td>设备文件保存位置</td>
</tr>
<tr>
<td align="center">/etc/</td>
<td>配置文件保存位置</td>
</tr>
<tr>
<td align="center">/var/</td>
<td>动态数据存放位置（缓存，日志，软件运行产生的文件）</td>
</tr>
<tr>
<td align="center">/proc/</td>
<td>虚拟文件系统，存在内存中，保存系统内核，进程，外部设备状态，网络状态灯<br />eg./proc/cpuinfo    cpu, /proc/devices    设备驱动列表，/proc/filesystem文件系统列表, /proc/net/网络协议</td>
</tr>
<tr>
<td align="center">/sys/</td>
<td>虚拟文件系统，保存内核相关信息</td>
</tr>
<tr>
<td align="center">/root/</td>
<td>root用户家目录</td>
</tr>
<tr>
<td align="center">/srv/</td>
<td>服务数据目录</td>
</tr>
<tr>
<td align="center">/tmp/</td>
<td>临时存放文件位置，所有用户均可访问</td>
</tr>
</tbody></table>
<h2 id="文件处理命令"><a href="#文件处理命令" class="headerlink" title="文件处理命令"></a>文件处理命令</h2><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">find  目录 条件 文件名</span><br><span class="line">					-name		#名字配合通配符使用，*?</span><br><span class="line">   		 	  -iname		#不区分大小写</span><br><span class="line">   		 	  -a -o			#且 或    </span><br><span class="line">   		  	-size +50M -size -100M	#查找文件&gt;50M且&lt;100M的文件</span><br><span class="line">				  -type f d l</span><br><span class="line">          -inum n		#节点	</span><br><span class="line">					-amin/cmin/mmin				#n分钟前被访问/文件数据元(例如权限)被修改/前曾被修改内容</span><br><span class="line">          -atime 50		#最近50天访问的文件</span><br><span class="line">          -mtime +50 -mtime -100	#查找修改时间&gt;50且&lt;100的文件										</span><br><span class="line">					-perm 0777	#查找权限为777的所有文件</span><br><span class="line">					-user root -name test.c	#查找所有者为root的所有文件,文件名为test.c的所有文件</span><br><span class="line">   				-group	developer   				                </span><br><span class="line">          -empty		#寻找文件大小为0 Byte的文件，或目录下没有任何子目录或文件的空目录</span><br><span class="line">          -exec/ok	#	找出文件后执行指定命令，搭配其他命令使用</span><br></pre></td></tr></table></figure>

<ul>
<li>不指明目录则在当前目录下寻找</li>
</ul>
<h5 id="文件name或正则匹配regex"><a href="#文件name或正则匹配regex" class="headerlink" title="文件name或正则匹配regex"></a>文件name或正则匹配regex</h5><p>  <code>find .</code>列出当前目录及子目录下所有文件和文件夹</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011131402.png" alt="image-20201011130829343" style="zoom:50%;" />

<p><code>find / -name init</code>   搜索文件名为init的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011123658.png" alt="image-20201011123658464" style="zoom:55%;" />

<p><code>find / -name *init*</code>    查找文件名中包含init的文件。通配符*，匹配任意个字符</p>
<p><code>find / -name *init???</code> 查找文件名为 “任意字符+init+三个字符”的文件。通配符？，匹配一个任意字符</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011123815.png" alt="image-20201011123815581" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011125422.png" alt="image-20201011125422850" style="zoom:50%;" />

<p><code>find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; </code>当前目录及子目录下查找所有以.txt和.pdf结尾的文件</p>
<p><code>find . ! -name &quot;*.txt&quot;</code>    当前目录下不以.txt结尾的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011133439.png" alt="image-20201011133439383" style="zoom:50%;" />

<p><code>find /usr/ -path &quot;*local&quot;</code>    匹配文件路径或者文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011131601.png" alt="image-20201011131600994" style="zoom:67%;" />

<p><code>find . -regex &quot;.*\(\.txt\|\.pdf\)$&quot;</code>基于正则表达式匹配文件路径，加i可忽略大小写</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011133006.png" alt="image-20201011133006434" style="zoom:67%;" />

<h5 id="根据类型匹配type"><a href="#根据类型匹配type" class="headerlink" title="根据类型匹配type"></a>根据类型匹配type</h5><p>f 文件 d目录 l 链接</p>
<p><code>find / -name init??? -type f</code>            查找文件名为init+3个任意字符的文件(排除目录)</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011130126.png" alt="image-20201011130126150" style="zoom:50%;" />

<h5 id="根据文件大小匹配size"><a href="#根据文件大小匹配size" class="headerlink" title="根据文件大小匹配size"></a>根据文件大小匹配size</h5><p>b块（512字节）/c字节/w字(字)/k/M/G</p>
<p>+大于-小于不指明则等于</p>
<p><code>find / -size +50M -size -100M</code>            搜索/下&gt;50且&lt;100的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011130016.png" alt="image-20201011130015998" style="zoom:50%;" />

<p><code>find / -mtime +50 -mtime -100</code>    查找修改时间&gt;50且&lt;100的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011130409.png" alt="image-20201011130409365" style="zoom:67%;" />

<h5 id="文件时间戳检索-a-c-m-min-time"><a href="#文件时间戳检索-a-c-m-min-time" class="headerlink" title="文件时间戳检索[a/c/m]min/time"></a>文件时间戳检索[a/c/m]min/time</h5><p><strong>访问时间</strong>（-atime/天，-amin/分钟）：用户最近一次访问时间。<br><strong>修改时间</strong>（-mtime/天，-mmin/分钟）：文件最后一次修改时间。<br><strong>变化时间</strong>（-ctime/天，-cmin/分钟）：文件数据元（例如权限等）最后一次修改时间。</p>
<p>+大于，-小于，不指明即等于</p>
<p><code>find . -type f -atime 7</code>     搜索恰好在七天前被访问过的所有文件</p>
<p><code>find . -type f -atime +7</code>    搜索超过七天内被访问过的所有文件</p>
<p><code>find . -type f -atime -7</code>        搜索最近七天内被访问过的所有文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011134435.png" alt="image-20201011134435148" style="zoom:50%;" />

<p><code> find . -type f -amin +50</code>        搜索访问时间超过50分钟的所有文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011135149.png" alt="image-20201011135149268" style="zoom:50%;" />

<p><code>find . -type f -newer test/aa</code>        找出比aa修改时间更长/新的所有文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011134759.png" style="zoom:50%;" />

<h5 id="删除匹配文件"><a href="#删除匹配文件" class="headerlink" title="删除匹配文件"></a>删除匹配文件</h5><p><code> find . -type f \( -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot; \) -delete</code></p>
<p>删除当前目录及子目录下查找所有以.txt和.pdf结尾的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011135639.png" alt="image-20201011135638996" style="zoom: 50%;" />



<h5 id="根据perm-权限-user-group匹配"><a href="#根据perm-权限-user-group匹配" class="headerlink" title="根据perm(权限),user,group匹配"></a>根据perm(权限),user,group匹配</h5><p>当前目录下搜索出权限为777的文件，这里bb是aa的硬链接</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011140110.png" alt="image-20201011140110264" style="zoom:67%;" />

<p> <code>find . -type f -name &quot;*.php&quot; ! -perm 644</code>        找出当前目录下权限不是644的php文件</p>
<p><code>find . -type f -user jen</code>        找出当前目录用户jen拥有的所有文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011140540.png" alt="image-20201011140540426" style="zoom:60%;" />

<p><code>find . -type f -group jen</code>        找出当前目录用户组jen拥有的所有文件</p>
<h5 id="搜索文件后执行命令-exec-ok"><a href="#搜索文件后执行命令-exec-ok" class="headerlink" title="搜索文件后执行命令 exec/ok"></a>搜索文件后执行命令 exec/ok</h5><p>-ok作用与-exec相同，但是ok需要确认执行的过程</p>
<p><code>find / -type f -perm 777 -exec/-ok    rm -f &#123;&#125; \;</code>    #删除/root/temp下权限为777的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011141309.png" alt="image-20201011141309008" style="zoom:50%;" />

<p><code>find -type f -name &quot;*.mp3&quot; -exec rm -f &#123;&#125; \;</code>        删除当前目录下后缀名为.mp3的文件</p>
<h5 id="empty搜索空文件-目录"><a href="#empty搜索空文件-目录" class="headerlink" title="empty搜索空文件/目录"></a>empty搜索空文件/目录</h5><p><code>find /root/temp -type f -empty    </code>#        查找目录下所有空文件      </p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011141629.png" alt="image-20201011141629750" style="zoom:55%;" />

<h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">locate	#在文件库中查找，快，可能不即时</span><br><span class="line">updatedb	#更新数据库</span><br><span class="line">					-i	忽略大小写</span><br></pre></td></tr></table></figure>

<p><code>locate pwd</code>    查找与pwd相关的所有文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011143004.png" alt="image-20201011143004122" style="zoom:60%;" />

<p><code>locate  /etc/sh</code>    #搜索etc目录下所有以sh开头的文件</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011143053.png" alt="image-20201011143053666" style="zoom:70%;" />


<h4 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h4><p>   搜索方法类似locate,比find快。可执行文件b、源代码文件s、帮助文件m在文件系统中的位置。</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011143621.png" alt="image-20201011143621611" style="zoom: 55%;" />



<h4 id="which"><a href="#which" class="headerlink" title="which"></a>which</h4><p><code>which 命令</code>  显示命令路径(PATH变量)，别名</p>
<p><code>which ls</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011143214.png" alt="image-20201011143213988" style="zoom:65%;" />


<h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i(忽略大小写)	-v 查找不匹配指定字符串的行	</span><br></pre></td></tr></table></figure>

<h5 id="grep规则表达式说明"><a href="#grep规则表达式说明" class="headerlink" title="grep规则表达式说明"></a>grep规则表达式说明</h5><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011151728.png" alt="image-20201011151728668" style="zoom: 40%;" />

<h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><p>过滤文件注释行            <code>grep ^[^#] /etc/xinetd.conf</code>或<code>grep -v ^# /etc/xinetd.conf    </code></p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011145017.png" alt="image-20201011145017754" style="zoom:50%;" />        <img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011145106.png" alt="image-20201011145106365" style="zoom:47%;" /> </p>
<p><code> cat myfile|grep ^[^u]</code>        查找非u开头的行内容</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011144849.png" alt="image-20201011144848968" style="zoom:60%;" />

<p><code>ps -ef|grep svn</code>        查找指定进程</p>
<p>加-c参数查找指定进程的个数</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201013120155.png" alt="image-20201011145449302" style="zoom:60%;" />



<p>  <code> cat test.txt | grep -f test2.txt</code>            指定规则文件，其内容含有一个或多个规则样式，让grep查找符合规则条件的文件内容，格式为每行一个规则样式</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011145838.png" alt="image-20201011145838697" style="zoom:60%;" />

<p>按照test2的格式匹配test中符合要求的行</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011145947.png" alt="image-20201011145924293" style="zoom:67%;" />

<p><code>grep -n &#39;linux&#39; test.txt</code>        从文件中查找含有关键字的行并显示行号</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011150308.png" alt="image-20201011150308876" style="zoom:67%;" />

<p><code>cat test.txt | grep -E&quot;ed|at&quot;</code>    #显示包含ed或at的字符行</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011150414.png" alt="image-20201011150414885" style="zoom:67%;" />



<p><code>grep &#39;[a-z]\&#123;7\&#125;&#39; *.txt</code>    #当前目录下以.txt 结尾的文件中的所有包含至少有7个连续小写字符的字符串所在行，因为在bash中{}有特殊含义使用需要转义</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011150533.png" alt="image-20201011150533406" style="zoom:67%;" />



<h2 id="权限管理命令"><a href="#权限管理命令" class="headerlink" title="权限管理命令"></a>权限管理命令</h2><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [&#123;ugoa&#125;&#123;+-=&#125;&#123;rwx&#125;][文件或目录]</span><br></pre></td></tr></table></figure>
<p><code>chmod g-w,o-w test</code>        </p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011152119.png" alt="image-20201011152119326" style="zoom: 50%;" />

<p><code>chmod 777 myfile</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011152229.png" alt="image-20201011152229768" style="zoom: 50%;" />

<p><code>chmod -R</code>            目录权限递归一次修改</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011152615.png" alt="image-20201011152615452" style="zoom: 50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011152840.png" alt="image-20201011152828702" style="zoom: 50%;" />

<ul>
<li>目录权限&amp;目录下文件权限不同。</li>
</ul>
<h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown [用户]  [目录/文件]	#改变文件所有者，只有管理员可改</span><br></pre></td></tr></table></figure>

<p><code>chown root myfile</code>    #文件所有者设置为root</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011153143.png" alt="image-20201011153143018" style="zoom:50%;" />

<p><code>chown root:root myfile</code>    #同时修改文件所有者root,所属组root</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011153242.png" alt="image-20201011153242285" style="zoom:50%;" />

<p>useradd<br>passwd</p>
<h4 id="chgrp-改变文件所属组"><a href="#chgrp-改变文件所属组" class="headerlink" title="chgrp   改变文件所属组"></a>chgrp   改变文件所属组</h4><p>如果用户不是该文件的文件主或超级用户(root)，则不能改变该文件的组。</p>
<p><strong>默认权限</strong>    创建者=文件所有者    缺省组(默认组，与创建者同名)=文件所有组</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011153520.png" alt="image-20201011153520914" style="zoom:50%;" />



<h4 id="umask-查看设置缺省权限"><a href="#umask-查看设置缺省权限" class="headerlink" title="umask 查看设置缺省权限"></a>umask 查看设置缺省权限</h4><p><code>umask -S </code>#查看新建目录缺省权限。文件-x，   linux新建文件默认没有执行权限                </p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011153920.png" alt="image-20201011153920664" style="zoom:67%;" />

<p>权限首位0 为特殊权限数字</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011154058.png" alt="image-20201011154058370" style="zoom:67%;" />





<h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><h4 id="man"><a href="#man" class="headerlink" title="man"></a>man</h4><blockquote>
<p>man 可以查询不同类型的帮助手册，当目标存在多个不同类型的帮助手册时，我们可以指定要查找的手册类型，也可以不指定，此时 man 会搜索所有类型的帮助手册，但是只会按照预定义的顺序展示第一个。预定义的顺序可以使用环境变量 $MANSECT 或配置文件 /usr/local/etc/man_db.conf 中的 SECTION 指令指定，默认为：</p>
<p><code>1 8 3 2 5 4 9 6 7</code></p>
<p>1    可执行程序或 Shell 命令</p>
<p>5    文件格式和约定，如 /etc/passwd</p>
</blockquote>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man 命令	#NAME 作用 /选项</span><br><span class="line">		配置文件	#NAME 存放信息  文件格式</span><br></pre></td></tr></table></figure>

<p><code>man 5 passwd</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011155252.png" alt="image-20201011155252025" style="zoom:47%;" />



<h4 id="whatis"><a href="#whatis" class="headerlink" title="whatis"></a>whatis</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatis 命令	#显示作用（简）</span><br></pre></td></tr></table></figure>

<p><code>whatis cp</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011155409.png" alt="image-20201011155409408" style="zoom:50%;" />



<h4 id="apropos"><a href="#apropos" class="headerlink" title="apropos"></a>apropos</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apropos 配置文件 	#显示配置文件作用</span><br></pre></td></tr></table></figure>

<p><code>apropos  ntp.conf</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011155537.png" alt="image-20201011155537873" style="zoom:67%;" />

<h4 id="–help-查看常用选项"><a href="#–help-查看常用选项" class="headerlink" title="–help 查看常用选项"></a>–help 查看常用选项</h4><h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><h4 id="help"><a href="#help" class="headerlink" title="help"></a>help</h4><h4 id="date与man-date"><a href="#date与man-date" class="headerlink" title="date与man date"></a>date与man date</h4><p><code>man date</code>        得到日期格式</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011155649.png" alt="image-20201011155649167" style="zoom:67%;" />

<p>根据指定格式MMDDhhmm修改时间</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011155808.png" alt="image-20201011155808566" style="zoom:67%;" />

<p>恢复标准时间        <code>ntpdate pool.ntp.org</code></p>
<h2 id="用户管理命令"><a href="#用户管理命令" class="headerlink" title="用户管理命令"></a>用户管理命令</h2><h4 id="useradd-amp-passwd"><a href="#useradd-amp-passwd" class="headerlink" title="useradd&amp;passwd"></a>useradd&amp;passwd</h4><p><code>useradd u1</code>添加用户u1        <code>passwd</code>修改密码</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011160305.png" alt="image-20201011160305452" style="zoom:67%;" />

<p>管理员外的普通用户密码需要满足一定复杂度要求</p>
<h4 id="who"><a href="#who" class="headerlink" title="who"></a>who</h4><p>登录用户信息</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011160458.png" alt="image-20201011160458715" style="zoom:67%;" />

<p>列2为终端号，pts/0-255表示远程/虚拟终端，tty1-7表示本地</p>
<h4 id="w-详细版who"><a href="#w-详细版who" class="headerlink" title="w(详细版who)"></a>w(详细版who)</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011160640.png" alt="image-20201011160640190" style="zoom:67%;" />

<p>第一行：开机时间点，已开机22h32分钟，登录用户，平均负载（5/10/15min）</p>
<h2 id="解压缩命令"><a href="#解压缩命令" class="headerlink" title="解压缩命令"></a>解压缩命令</h2><h4 id="gzip-压缩率大"><a href="#gzip-压缩率大" class="headerlink" title="gzip    (压缩率大)"></a>gzip    (压缩率大)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.gz</span><br><span class="line">解压1：gunzip FileName.gz</span><br><span class="line">解压2：gzip -d FileName.gz</span><br><span class="line">压缩：gzip FileName</span><br><span class="line"></span><br><span class="line">gzip -rf temp		</span><br><span class="line">gunzip -rf temp或 gzip -drf temp  </span><br><span class="line"><span class="meta">#</span><span class="bash">-r递归压缩，用于压缩目录;-f强制压缩，忽略链接文件警告;-v显示指令执行过程。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.tar.gz</span><br><span class="line">解压：tar zxvf FileName.tar.gz</span><br><span class="line">压缩：tar zcvf FileName.tar.gz DirName</span><br></pre></td></tr></table></figure>


<h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.tar</span><br><span class="line">解包：tar -xvf FileName.tar									#-v显示涉及的文件;-f指定压缩文件</span><br><span class="line">打包：tar -cvf FileName.tar DirName	</span><br></pre></td></tr></table></figure>

<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.zip</span><br><span class="line">解压：unzip FileName.zip</span><br><span class="line">压缩：zip FileName.zip DirName</span><br></pre></td></tr></table></figure>

<h4 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.bz2</span><br><span class="line">解压1：bzip2 -d FileName.bz2</span><br><span class="line">解压2：bunzip2 -k FileName.bz2				#-k 解压缩后保留原文件</span><br><span class="line">压缩： bzip2 -z FileName</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.tar.bz2</span><br><span class="line">解压：tar -jxvf FileName.tar.bz2</span><br><span class="line">压缩：tar -jcvf FileName.tar.bz2 DirName</span><br></pre></td></tr></table></figure>

<h2 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h2><h4 id="write-用户名"><a href="#write-用户名" class="headerlink" title="write 用户名"></a>write 用户名</h4><p>   “写信/聊天”，ctrl+D保存结束聊天</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011164547.png" alt="image-20201011164547883" style="zoom:67%;" />

<h4 id="wall-广播"><a href="#wall-广播" class="headerlink" title="wall 广播"></a>wall 广播</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011165011.png" alt="image-20201011165011584" style="zoom:50%;" />

<h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4><h4 id="ifconfig查看网卡配置信息"><a href="#ifconfig查看网卡配置信息" class="headerlink" title="ifconfig查看网卡配置信息"></a>ifconfig查看网卡配置信息</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011165207.png" alt="image-20201011165207660" style="zoom: 50%;" />

<ul>
<li><p>ens33是第一块网卡</p>
</li>
<li><p>UP（代表网卡开启状态）RUNNING（代表网卡的网线被接上）MULTICAST（支持组播）MTU:1500（最大传输单元）：1500字节</p>
</li>
<li><p>inet addr 用来表示网卡的IP地址，此网卡的 IP地址是 192.168.72.88，广播地址， Bcast:192.168.72.255，掩码地址Mask:255.255.255.0 </p>
</li>
<li><p>连接类型：Ethernet（以太网）HWaddr（硬件mac地址）</p>
</li>
<li><p>接收、发送数据包情况统计</p>
</li>
<li><p>接收、发送数据字节数统计信息</p>
</li>
<li><p>lo表示本地回环地址，一般用于测试网络程序</p>
</li>
</ul>
<h5 id="启动关闭指定网卡"><a href="#启动关闭指定网卡" class="headerlink" title="启动关闭指定网卡"></a>启动关闭指定网卡</h5><p>练习的时候，ssh登陆linux服务器操作要小心，关闭了就不能开启了，除非你有多网卡。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens33 up</span><br><span class="line">ifconfig ens33 down</span><br></pre></td></tr></table></figure>

<h5 id="为网卡配置ip地址"><a href="#为网卡配置ip地址" class="headerlink" title="为网卡配置ip地址"></a>为网卡配置ip地址</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens33 198.168.8.250		#修改网卡ens33 ip为198.168.8.250</span><br><span class="line">ifconfig ens33 192.168.120.56 netmask 255.255.255.0 </span><br><span class="line"> ifconfig ens33 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255</span><br></pre></td></tr></table></figure>

<h5 id="为网卡配置和删除ipv6地址"><a href="#为网卡配置和删除ipv6地址" class="headerlink" title="为网卡配置和删除ipv6地址"></a>为网卡配置和删除ipv6地址</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens33 add 33ffe:3240:800:1005::2/64</span><br><span class="line">ifconfig ens33 del 33ffe:3240:800:1005::2/64</span><br></pre></td></tr></table></figure>

<h5 id="修改Mac地址"><a href="#修改Mac地址" class="headerlink" title="修改Mac地址"></a>修改Mac地址</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens33 hw ether 00:AA:BB:CC:DD:EE</span><br></pre></td></tr></table></figure>



<h4 id="mail"><a href="#mail" class="headerlink" title="mail"></a>mail</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011170701.png" alt="image-20201011170700945" style="zoom:50%;" />

<p>发送邮件 <code>mail 用户名</code></p>
<p>接收：<code>mail</code> 查看邮件信息后回车显示邮件详情</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011170829.png" alt="image-20201011170829512" style="zoom:67%;" />

<p>看完后ctrl+D保存退出</p>
<h4 id="last-目前与过去登入系统的用户信息"><a href="#last-目前与过去登入系统的用户信息" class="headerlink" title="last 目前与过去登入系统的用户信息"></a>last 目前与过去登入系统的用户信息</h4><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011171124.png" alt="image-20201011171124412" style="zoom: 50%;" />



<h4 id="lastlog特定用户登陆时间"><a href="#lastlog特定用户登陆时间" class="headerlink" title="lastlog特定用户登陆时间"></a>lastlog特定用户登陆时间</h4><p><code>lastlog -u uid</code></p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011171433.png" alt="image-20201011171433068" style="zoom:50%;" />



<h4 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h4><p><code>tarceroute hostname</code></p>
<h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><p><code>netstat -rn</code>    #查看本机路由表</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011171904.png" alt="image-20201011171904725" style="zoom:67%;" />

<p><code> netstat -tuln</code>        tcp和udp服务监听</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011172039.png" alt="image-20201011172039429" style="zoom:50%;"/> 

<p><code>netstat -an</code>    #显示所有网络连接</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011172315.png" alt="image-20201011172315583" style="zoom:50%;" />

<ul>
<li><p>netstat的输出结果可以分为两个部分：</p>
<p>一个是Active Internet connections，称为有源TCP连接，其中”Recv-Q”和”Send-Q”指的是接收队列和发送队列。这些数字一般都应该是0。如果不是则表示软件包正在队列中堆积。这种情况只能在非常少的情况见到。</p>
<p>另一个是Active UNIX domain sockets，称为有源Unix域套接口(和网络套接字一样，但是只能用于本机通信，性能可以提高一倍)。</p>
<p>Proto显示连接使用的协议,RefCnt表示连接到本套接口上的进程号,Types显示套接口的类型,State显示套接口当前的状态,Path表示连接到套接口的其它进程使用的路径名。</p>
</li>
<li><p>套接口类型</p>
<p>-t ：TCP</p>
<p>-u ：UDP</p>
<p>-raw ：RAW类型</p>
<p>–unix ：UNIX域类型</p>
<p>–ax25 ：AX25类型</p>
<p>–ipx ：ipx类型</p>
<p>–netrom ：netrom类型</p>
</li>
<li><p><strong>状态说明：</strong></p>
<p><strong>LISTEN</strong>：侦听来自远方的TCP端口的连接请求</p>
<p>SYN-SENT：再发送连接请求后等待匹配的连接请求（如果有大量这样的状态包，检查是否中招了）</p>
<p>SYN-RECEIVED：再收到和发送一个连接请求后等待对方对连接请求的确认（如有大量此状态，估计被flood攻击了）</p>
<p><strong>ESTABLISHED</strong>：代表一个打开的连接</p>
<p>FIN-WAIT-1：等待远程TCP连接中断请求，或先前的连接中断请求的确认</p>
<p>FIN-WAIT-2：从远程TCP等待连接中断请求</p>
<p>CLOSE-WAIT：等待从本地用户发来的连接中断请求</p>
<p>CLOSING：等待远程TCP对连接中断的确认</p>
<p>LAST-ACK：等待原来的发向远程TCP的连接中断请求的确认（不是什么好东西，此项出现，检查是否被攻击）</p>
<p>TIME-WAIT：等待足够的时间以确保远程TCP接收到连接中断请求的确认</p>
<p>CLOSED：没有任何连接状态</p>
</li>
</ul>
<h4 id="setup-配置网络-nmtui"><a href="#setup-配置网络-nmtui" class="headerlink" title="setup 配置网络 nmtui"></a><del>setup 配置网络</del> nmtui</h4><p><code>setup</code>在centos7版本里已经没有网络配置选项，使用<code>nmtui</code>进入</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011173835.png" alt="image-20201011173835711" style="zoom:50%;" />

<p>进入编辑</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011174044.png" alt="image-20201011174043984" style="zoom: 40%;" />

<p>回车进入配置网卡</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011174120.png" alt="image-20201011174120060" style="zoom:50%;" />

<p>回到网络编辑界面激活</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011174214.png" alt="image-20201011174214088" style="zoom:50%;" />



<h4 id="mount-t文件系统-设备文件名"><a href="#mount-t文件系统-设备文件名" class="headerlink" title="mount [-t文件系统]  设备文件名"></a>mount [-t文件系统]  设备文件名</h4><p><code>mount -t 文件系统 设备文件名 挂载点/mnt/xxx</code></p>
<ol>
<li><p><code>fdisk -l</code> 查看设备文件名</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011174622.png" alt="image-20201011174621982" style="zoom:67%;" />
</li>
<li><p>插入可移动设备(这里用u盘演示)</p>
<p>出现提示</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011175340.png" alt="image-20201011175340344" style="zoom:50%;" />

<p>关机修改虚拟机设置usb兼容3.1,重启即可</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011175643.png" alt="image-20201011175630756" style="zoom:50%;" />



</li>
</ol>
<p>检查与虚拟机连接状态，若未连接(连接到主机)，</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011174758.png" alt="image-20201011174758836" style="zoom:50%;" />

<p>linux系统不能识别ntfs/exfat文件系统，检查u盘类型(win下查看u盘属性)，安装支持</p>
<pre><code>mount unknown filesystem type ntfs
解决：安装支持包
wget https://tuxera.com/opensource/ntfs-3g_ntfsprogs-2017.3.23.tgz
tar -zxf ntfs-3g_ntfsprogs-2017.3.23.tgz
cd ntfs-3g_ntfsprogs-2017.3.23
./configure;make;make install 

mount -t ntfs-3g 设备文件名 挂载点

exfat
yum install -y http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm
yum install exfat-utils fuse-exfat
mount -t exfat 设备文件名 挂载点</code></pre>
<p>重新检查分区情况，得到u盘设备文件名</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011180006.png" alt="image-20201011180006769" style="zoom:50%;" />

<p>在/mnt下创建目录空usb来挂载u盘</p>
<p><code>mount -t ntfs-3g 设备文件名 挂载点</code>     （ntfs）</p>
<p><code>mount -t exfat /dev/sdb1 /mnt/usb</code>    (exfat)</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011185213.png" alt="image-20201011185213349" style="zoom:67%;" />

<p>可通过挂载点访问u盘</p>
<p>取消挂载</p>
<p><code>umount 设备文件名/挂载点</code></p>
<p>出现的一些问题：</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011180952.png" alt="image-20201011180952149" style="zoom:67%;" />

<p>提示设备错误，连接主机，查看了下u盘属性发现是exfat格式，linux识别不了，上面命令指定的文件系统也不对。好吧，装一下exfat的支持</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011183437.png" alt="image-20201011183437281" style="zoom:67%;" />

<p>报错挂在目标已使用，额实际上已经挂载了，这里出问题的原因是我在另一个终端正在换源造成的，结束后就能正常挂载了</p>
<h2 id="关机重启命令"><a href="#关机重启命令" class="headerlink" title="关机重启命令"></a>关机重启命令</h2><h4 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h4>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shutdown -c 取消前一个关机命令</span><br><span class="line">shutdown -h 关机</span><br><span class="line">shutdown -r 重启</span><br></pre></td></tr></table></figure>

<h4 id="halt"><a href="#halt" class="headerlink" title="halt"></a>halt</h4><h4 id="poweroff"><a href="#poweroff" class="headerlink" title="poweroff"></a>poweroff</h4><h4 id="logout"><a href="#logout" class="headerlink" title="logout"></a>logout</h4><h4 id="reboot"><a href="#reboot" class="headerlink" title="reboot"></a>reboot</h4><h4 id="init-0和init-6"><a href="#init-0和init-6" class="headerlink" title="init 0和init 6"></a>init 0和init 6</h4><ul>
<li><p>系统运行级别</p>
<p>0关机，1单用户，2不完全多用户，3完全多用户，4未分配，5图形界面，6重启</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat　/etc/inittab</span><br><span class="line">runlevel	#查看当前系统运行级别</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="其他小问题："><a href="#其他小问题：" class="headerlink" title="其他小问题："></a>其他小问题：</h2><p>终端提示符显示的是-bash-4.2# 而不是root@主机名 + 路径的显示方式原因是root在/root下面的几个配置文件丢失，丢失文件如下：1、.bash_profile2、.bashrc以上这些文件是每个用户都必备的文件。使用以下命令从主默认文件重新拷贝一份配置信息到/root目录下<br>cp /etc/skel/.bashrc /root/</p>
<p>cp /etc/skel/.bash_profile  /root/</p>
<p>然后重新登录就恢复正常了。</p>
<p>检查后发现是因为额我把这部分文件压缩了，解压后再次打开终端就正常了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/linux%E5%9F%BA%E7%A1%80-12-%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/10/linux%E5%9F%BA%E7%A1%80-12-%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" class="post-title-link" itemprop="url">linux基础_12.备份与恢复</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-10 17:54:38" itemprop="dateCreated datePublished" datetime="2020-10-10T17:54:38+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:39" itemprop="dateModified" datetime="2020-10-13T12:58:39+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h3 id="需要备份的数据"><a href="#需要备份的数据" class="headerlink" title="需要备份的数据"></a>需要备份的数据</h3><ul>
<li><p>/root/</p>
</li>
<li><p>/home/</p>
</li>
<li><p>/var/spool/mail/</p>
</li>
<li><p>/etc/</p>
</li>
<li><p>其他/var/log等</p>
</li>
<li><p>安装服务的数据（eg.）</p>
<p>apache：配置文件，网页主目录，日志文件</p>
<p>myslq：(源码包安装)/usr/local(或安装目录)/mysql/data(5.5);(rpm安装)/var/lib/mysql</p>
</li>
</ul>
<p>备份：不放在同一个篮子里—-异地备份</p>
<h3 id="备份策略"><a href="#备份策略" class="headerlink" title="备份策略"></a>备份策略</h3><ol>
<li><p>完全备份</p>
<p>全部备份，取决于数据重要性。<br>理论上最好，恢复备份方便，但需要考虑备份时间，占用硬盘空间</p>
</li>
<li><p>增量备份</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010233029.png" alt="image-20201010233029033" style="zoom:50%;" />

<p>理论上备份占用空间最小，但恢复并比较麻烦</p>
<p>每次备份与上次相比</p>
</li>
<li><p>差异备份</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010233218.png" alt="image-20201010233218779" style="zoom:50%;" />

<p>每次备份与原始数据相比</p>
<p>比完全备份少点，恢复比增量方便</p>
</li>
</ol>
<h3 id="常见备份命令dump，恢复restore"><a href="#常见备份命令dump，恢复restore" class="headerlink" title="常见备份命令dump，恢复restore"></a>常见备份命令dump，恢复restore</h3><h4 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h4><p>查看是否安装</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010233632.png" alt="image-20201010233632051" style="zoom:60%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install dump								#安装</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dump [] 备份后文件名 文件/目录</span><br><span class="line">			-level			0-9备份级别，0完全备份，1增量备份，1-第一次，2-第二次...</span><br><span class="line">			-f file			指定备份后的文件名</span><br><span class="line">			-u					(常用)备份成功之后，记录备份时间在/etc/dumpdates</span><br><span class="line">			-v					详细输出信息</span><br><span class="line">			-j					(常用)备份文件压缩为.bz2</span><br><span class="line">			-W					显示允许被dump的分区的备份等级及时间</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dump -0uj -f /root/boot.bak.bz2 /boot/</span><br><span class="line"><span class="meta">#</span><span class="bash">完全备份，写入时间，压缩，指定备份后文件名 备份目录</span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010234609.png" alt="image-20201010234609568" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011091637.png" alt="image-20201010234735466" style="zoom:47%;" />

<p>在/boot/内加入数据/boot/temp(约20k)进行增量备份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dump -1uj -f /root/boot.bak1.bz2 /boot/</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010235746.png" alt="image-20201010235746022" style="zoom:60%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010235904.png" alt="image-20201010235904693" style="zoom:64%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dump -W							查询整个分区备份情况</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011000019.png" alt="image-20201011000018999" style="zoom:67%;" />

<p>备份文件或目录，只能完全备份，不再支持增量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dump -0j -f /root/etc.dump.bz2 /etc/</span><br></pre></td></tr></table></figure>

<p>dump命令只有在备份分区时才可以增量备份</p>
<h4 id="restore恢复"><a href="#restore恢复" class="headerlink" title="restore恢复"></a>restore恢复</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">restore [模式选项][选项]</span><br><span class="line">(不可混用)-C:比较备份数据与实际数据变化</span><br><span class="line">				-i:进入交互模式，手工选择要恢复的文件</span><br><span class="line">				-t:查看模式，查看备份文件中拥有哪些数据</span><br><span class="line">				-r:还原模式，用于数据还原</span><br><span class="line">									-f 指定备份文件名</span><br></pre></td></tr></table></figure>

<p>实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">修改/boot目录中内核进行文件名(记得保留原名，用于最后恢复，否则下次开机崩溃)</span></span><br><span class="line">mv /boot/initramfs-3.10.0-957.el7.x86_64.img /boot/initramfs-3.10.0-957.el7.x86_64.img.bak</span><br><span class="line"><span class="meta">#</span><span class="bash">比较现有文件和备份数据变化,restore发现内核镜像文件丢失</span></span><br><span class="line">restore -C -f /root/boot.bak.bz2</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011001307.png" alt="image-20201011001307484" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /boot/initramfs-3.10.0-957.el7.x86_64.img.bak /boot/initramfs-3.10.0-957.el7.x86_64.img</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011001426.png" alt="image-20201011001425952" style="zoom:67%;" />

<p>查看模式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restore -t -f boot.bak.bz2</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011001549.png" alt="image-20201011001549509" style="zoom:50%;" />

<p>还原模式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 还原boot.bak.bz2分区备份</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.先还原完全备份的数据</span></span><br><span class="line">mkdir boot.test</span><br><span class="line">cd boot.test/</span><br><span class="line">restore -r -f /root/boot.bak.bz2		#原始数据恢复，同时解压缩</span><br><span class="line">restore -r -f /root/boot.bak1.bz2		#恢复增量备份</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201011001938.png" alt="image-20201011001938236" style="zoom:65%;" />

<p>还原文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">还原/etc/目录备份etc.dump.bz2,创建进入目录</span></span><br><span class="line">restore -r -f etc.dump.bz2</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/linux%E5%9F%BA%E7%A1%80-11-%E5%90%AF%E5%8A%A8%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/10/linux%E5%9F%BA%E7%A1%80-11-%E5%90%AF%E5%8A%A8%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux基础_11.启动管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-10 17:39:23" itemprop="dateCreated datePublished" datetime="2020-10-10T17:39:23+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 12:58:36" itemprop="dateModified" datetime="2020-10-13T12:58:36+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>



<h2 id="（Centos6-3）启动管理"><a href="#（Centos6-3）启动管理" class="headerlink" title="（Centos6.3）启动管理"></a>（Centos6.3）启动管理</h2><h4 id="运行级别"><a href="#运行级别" class="headerlink" title="运行级别"></a>运行级别</h4><table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody><tr>
<td>关机</td>
<td>单用户模式，类似win安全模式，用于修复系统</td>
<td>不完全的命令行模式，不含NFS</td>
<td>完全的命令行模式，标准字符界面</td>
<td>系统保留</td>
<td>图形界面</td>
<td>重启动</td>
</tr>
</tbody></table>
<h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runlevel			#查看运行级别</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010213339.png" alt="image-20201010213339479" style="zoom: 60%;" />

<p><code>N 5</code>表示开机直接进入图形界面，如果是从5到3，则显示<code>5 3</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">init 0			#关机，不保存正在运行的状态，不推荐</span><br><span class="line">init 运行级别			#改变</span><br></pre></td></tr></table></figure>

<h5 id="系统默认运行级别"><a href="#系统默认运行级别" class="headerlink" title="系统默认运行级别"></a>系统默认运行级别</h5><p>修改init配置文件<code>/etc/inittab</code>(centos7之后不再使用)</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010214007.png" alt="image-20201010214006985" style="zoom:50%;" />

<p>centos7定义在/lib/systemd/system下</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010223127.png"></p>
<h2 id="启动引导程序grep"><a href="#启动引导程序grep" class="headerlink" title="启动引导程序grep"></a>启动引导程序grep</h2><p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/516752">Centos7启动过程</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010214217.png" alt="image-20201010214217860"></p>
<p>加电自检—-主引导修复—-grub启动引导程序—-加载内核（压缩）—-内核解压缩，自检(dmessg)—-initranfs读取建立仿真目录—-加载驱动-挂载真正根目录-系统启动进程调用<code>/sbin/init</code>—-进一步调用<code>/etc/init/rcS.conf</code>—-调用<code>rc.sysinit</code>系统初始化（最基本功能）—- 确定运行级别—-不同界面对应的附加程序</p>
<ul>
<li><p>linux驱动包含在内核中，不需要手工安装，除非已包含驱动中没有<br>windows只安装操作系统，驱动需要另外安装</p>
</li>
<li><p>IDE接口驱动，直接在内存中，可直接识别加载<br>现有大多数计算机硬盘SATA/SCSI，linux内核认为不是必须，作为模块放在/lib下，内核需要从/lib下读取驱动才能识别硬盘。（类似钥匙锁在房间里开门）<br>initranfs文件系统有一个模拟根目录，内核先加载文件系统将常见驱动加载到内核，建立仿真目录，加载硬盘分区，加载其他分区（类似找开锁公司配假钥匙开门），该文件实际在/boot/下</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010215732.png" alt="image-20201010215732335" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010220238.png" alt="image-20201010220238327" style="zoom:51%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpio -ivcdu &lt; ...		#解压缩</span><br></pre></td></tr></table></figure>

  <img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010220513.png" alt="image-20201010220513473" style="zoom:50%;" />








</li>
</ul>
<ul>
<li><p>/sbin/init运行用户空间的第一个应用程序</p>
<p>init:</p>
<p>Centos 5: SysV init       配置文件：/etc/inittab</p>
<p>Centos 6: Upstart        配置文件：/etc/inittab;/etc/init/*.conf(主要）</p>
<p>Centos 7: systemd       配置文件：/etc/systemd/system;/usr/lib/systemd/system</p>
</li>
</ul>
<ul>
<li><p>系统初始化</p>
<p><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010221758.png" alt="image-20201010221758282" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010221812.png" alt="image-20201010221812887" style="zoom:50%;" /></p>
</li>
<li><p>rcx.d/            软链接</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010222129.png" alt="image-20201010222129704" style="zoom:45%;" />
</li>
<li><p>centos7运行级别</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010223127.png" alt="image-20201010223127022" style="zoom:67%;" />


</li>
</ul>
<h2 id="系统修复模式-grub配置文件"><a href="#系统修复模式-grub配置文件" class="headerlink" title="系统修复模式-grub配置文件"></a>系统修复模式-grub配置文件</h2><h3 id="grep中分区的表示"><a href="#grep中分区的表示" class="headerlink" title="grep中分区的表示"></a>grep中分区的表示</h3><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010222523.png" alt="image-20201010222523342" style="zoom:60%;" />


<p>Centos6</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010224309.png" alt="image-20201010224309067" style="zoom: 67%;" />

<ul>
<li>default:默认选择的系统，0-第一个，1-下一个（如果有2个）</li>
<li>timeout：等待选择时间</li>
<li>背景图保存位置，h(0,0)=/boot/</li>
<li>标题    \启动程序的保护分区/主目录        \    /(boot)内核加载时的选项(默认，一般不调整)    \指定内存文件系统镜像文件位置</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/linux%E5%9F%BA%E7%A1%80-10-%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mij0lb">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mij0lb's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/10/linux%E5%9F%BA%E7%A1%80-10-%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux基础_10.日志管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-10 17:39:10" itemprop="dateCreated datePublished" datetime="2020-10-10T17:39:10+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 13:08:16" itemprop="dateModified" datetime="2020-10-13T13:08:16+08:00">2020-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="日志管理简介"><a href="#日志管理简介" class="headerlink" title="日志管理简介"></a>日志管理简介</h2><h3 id="日志服务"><a href="#日志服务" class="headerlink" title="日志服务"></a>日志服务</h3><p>centos 6.x中日志服务已经由rsyslogd取代了syslogd服务</p>
<h5 id="rsyslogd新特点"><a href="#rsyslogd新特点" class="headerlink" title="rsyslogd新特点"></a>rsyslogd新特点</h5><ol>
<li>tcp协议传输，更安全</li>
<li>日志消息及时的分析框架</li>
<li>后台数据库</li>
<li>配置文件中可以写简单的逻辑判断</li>
<li>向下兼容（syslog）<h5 id="确定服务启动"><a href="#确定服务启动" class="headerlink" title="确定服务启动"></a>确定服务启动</h5>默认启动和自启动</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010175945.png" alt="image-20201010175945906" style="zoom:60%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setup设置+*或								#启动</span><br><span class="line">systemctl start rsyslog</span><br><span class="line">systemctl status rsyslog</span><br><span class="line">systemctl enabled  rsyslog		#自启动</span><br><span class="line">systemctl is-enabled  rsyslog#查询是否自启动</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010180607.png" alt="image-20201010180607789" style="zoom:67%;" />

<p>自启动检查时使用<code>chkconfig --list|grep rsyslog</code>失败</p>
<h3 id="常见日志作用"><a href="#常见日志作用" class="headerlink" title="常见日志作用"></a>常见日志作用</h3><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010181149.png" alt="image-20201010181149657" style="zoom:50%;" />

<ul>
<li><p>/var/log/cron        系统定时任务相关日志</p>
</li>
<li><p>/var/log /cups    打印信息日志</p>
</li>
<li><p>/var/log /dmesg        开机自检信息</p>
</li>
<li><p>/var/log /btmp        错误登录日志，二进制文件，不能直接vi打开需要使用命令lastb查看</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010181238.png" alt="image-20201010181238238" style="zoom:47%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010181341.png" alt="image-20201010181341906" style="zoom:55%;" />
</li>
<li><p>/var/log/lastlog        所有用户最后登录时间，二进制文件，使用lastlog查看</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010181608.png" alt="image-20201010181608483" style="zoom:60%;margin: 0 auto;" />

<p>伪用户Never loged in</p>
</li>
<li><p>/var/log/maillog            记录邮件信息</p>
</li>
<li><p>/var/log/message            记录系统重要信息，系统出现问题首先检查的日志文件</p>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010181832.png" alt="image-20201010181832758" style="zoom: 50%;" div align=center />

<ul>
<li><p>/var/log/secure            验证和授权方面的信息，设计账户密码登录,eg.系统登录，ssh,su切换用户，sudo授权，添加修改用户密码都会记录再这个日志文件中</p>
</li>
<li><p>/var/log/wtmp            永久记录所有用户登录/注销信息，系统启动关机重启时间。二进制文件，last查看</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010182136.png" alt="image-20201010182136448" style="zoom:50%;" />
</li>
<li><p>/var/log/utmp            当前以登录用户信息，随用户登录注销不断变化，只记录当前登录用户信息，不能使用vi查看，可用<code>w</code>,<code>who</code>,<code>users</code></p>
</li>
</ul>
<p>除了系统默认日志，采用rmp格式安装的系统服务也会默认把日志记录在/var/log/目录中（源码包安装的服务日志再源码包指定目录中）。这些日志不是由rsyslogd服务记录和管理，而是使用自己的日志管理文档记录自身日志</p>
<ul>
<li>/var/log/httpd/            </li>
<li>/var/log/mail/            </li>
<li>/var/log/samba/            rpm安装的samba服务的日志目录        </li>
<li>/var/log/sssd/            守护进程安全服务目录</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mickole/p/3188321.html"><strong>守护进程</strong></a></p>
<p>​        Linux Daemon（守护进程）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。它不需要用户输入就能运行而且提供某种服务，不是对整个系统就是对某个用户程序提供服务。Linux系统的大多数服务器就是通过守护进程实现的。常见的守护进程包括系统日志进程syslogd、 web服务器httpd、邮件服务器sendmail和数据库服务器mysqld等。</p>
<p>​        守护进程一般在系统启动时开始运行，除非强行终止，否则直到系统关机都保持运行。守护进程经常以超级用户（root）权限运行，因为它们要使用特殊的端口（1-1024）或访问某些特殊的资源。</p>
<p>​        一个守护进程的父进程是init进程，因为它真正的父进程在fork出子进程后就先于子进程exit退出了，所以它是一个由init继承的孤儿进程。守护进程是非交互式程序，没有控制终端，所以任何输出，无论是向标准输出设备stdout还是标准出错设备stderr的输出都需要特殊处理。</p>
<p>守护进程的名称通常以d结尾，比如sshd、xinetd、crond等</p>
</blockquote>
<h2 id="rsyslogd-日志服务"><a href="#rsyslogd-日志服务" class="headerlink" title="rsyslogd 日志服务"></a>rsyslogd 日志服务</h2><h3 id="日志文件格式"><a href="#日志文件格式" class="headerlink" title="日志文件格式"></a>日志文件格式</h3><p>事件产生时间    发生事件的服务器的主机名     产生事件的服务器或程序名     时间的具体信息</p>
<p>​    eg./var/log/message</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010185128.png" alt="image-20201010185128047" style="zoom:67%;" />

<h3 id="etc-rsyslog-config配置文件"><a href="#etc-rsyslog-config配置文件" class="headerlink" title="/etc/rsyslog.config配置文件"></a>/etc/rsyslog.config配置文件</h3><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010185640.png" alt="image-20201010185640893" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> The authpriv file has restricted access.</span></span><br><span class="line">authpriv.*                   /var/log/secure</span><br><span class="line">认证相关服务.所有日志等级				记录位置</span><br><span class="line"></span><br><span class="line">格式</span><br><span class="line">服务名称[连接符号]日志等级			记录位置</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>服务名称</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010191034.png" alt="image-20201010191034266" style="zoom:40%;" /> 

<p>需要什么日志，将服务写进去即可</p>
</li>
<li><p>连接符</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010191723.png" alt="image-20201010191723108" style="zoom:50%;" />
</li>
<li><p>日志等级</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010192253.png" alt="image-20201010192253580" style="zoom:50%;" />

<p>（从上到下）等级越高，信息量越小，处理等级越高，危害越大</p>
</li>
<li><p>记录位置</p>
<ul>
<li>日志文件的绝对路径，eg:/var/log/secure</li>
<li>系统设备文件，eg:/dev/lp0</li>
<li>转发给远程主机，eg:@192.168.0.210：514</li>
<li>用户名，root</li>
<li>忽略或丢弃日志，如~</li>
</ul>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010193627.png" alt="image-20201010193627661" style="zoom:50%;" />

<p>内核日志默认不记录，想记录可打开</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010193735.png" alt="image-20201010193735034" style="zoom:49%;" />

<p>message:记录任何等级高于info的日志，mail,authpriv,cron不记录</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010193953.png" alt="image-20201010193953116" style="zoom:50%;" />

<p>疼痛等级发送给任何人</p>
<h2 id="日志轮替"><a href="#日志轮替" class="headerlink" title="日志轮替"></a>日志轮替</h2><p>网站PV(点击量)上万，日志不做处理，硬盘占用</p>
<h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><ol>
<li><p>切割：每天的日志单独写</p>
</li>
<li><p>删除轮替：旧日志删除腾出空间记录新日志</p>
</li>
</ol>
<p>apache自带支持日志切割不支持轮替</p>
<h3 id="日志文件命名规则"><a href="#日志文件命名规则" class="headerlink" title="日志文件命名规则"></a>日志文件命名规则</h3><ol>
<li><p>日志配置文件中拥有<code>dateext</code>参数时，会用日志日期作为日志文件后缀。eg.secure-20130605</p>
<p>日志名不会重叠，无需改名，只需要保存指定个数，删除多余文件即可</p>
</li>
<li><p>配置文件中没有<code>dateext</code>参数，则需要改名，保证日志不会覆盖。<br>轮替时：(1th)secure改为secure.1,(2th)secure.1改为secure.2,当然会新建新的日志secure,以此类推。</p>
</li>
</ol>
<h3 id="logrotate配置文件"><a href="#logrotate配置文件" class="headerlink" title="logrotate配置文件"></a>logrotate配置文件</h3><img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010200901.png" alt="image-20201010200901078" style="zoom:47%;" />

<ul>
<li>参数</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010202318.png" alt="image-20201010202317947" style="zoom:50%;" />

<ul>
<li><p>{}外是基本配置，{}内重叠按{}内生效</p>
</li>
<li><p>rpm包安装的服务默认支持，源码包安装的服务在安装目录下，要想轮替需要加入</p>
<p>eg.</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010210246.png" alt="image-20201010210246497" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010210339.png" alt="image-20201010210339023" style="zoom:50%;" />

</li>
</ul>
<h3 id="logrotate命令"><a href="#logrotate命令" class="headerlink" title="logrotate命令"></a>logrotate命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logrotate [选项] 配置文件</span><br><span class="line">					-v		显示日志轮替过程</span><br><span class="line">					-f		强制日志轮替，不管条件是否符合，配置文件中所有日志强制轮替</span><br><span class="line">不加选项=按照配置文件中的条件进行日志轮替</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010210843.png" alt="image-20201010210843407" style="zoom:45%;" />

<p>显示有20个日志需要轮替，下图中apache日志轮替也加入</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010211027.png" alt="image-20201010211027100" style="zoom:40%;" />

<p>修改下时间再次查看</p>
<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010211214.png" alt="image-20201010211214547" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/mij0lb/PictureBed/BlogImg20201010211445.png" alt="image-20201010211445630" style="zoom:50%;" />

<p>记得校准时间<code>ntpdate pool.ntp.org</code> 通过ntp服务自动获取网络时间并同步</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">mij0lb</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020-10 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mij0lb</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
